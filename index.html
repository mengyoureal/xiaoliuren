<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>é“é—¨ç§˜ä¼ å°å…­å£¬ä¹ç¥ç‰ˆ - æ‰‹æœºç‰ˆ (Bilingual)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet" />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: "#165DFF",
            secondary: "#722ED1",
            accent: "#FF6B35",
            success: "#00B42A",
            warning: "#FF7D00",
            danger: "#F53F3F",
            dark: "#1D2129",
            light: "#F2F3F5",
          },
          fontFamily: {
            chinese: ["PingFang SC", "Microsoft YaHei", "sans-serif"],
          },
          animation: {
            "fade-in": "fadeIn 0.6s ease-in-out",
            "slide-up": "slideUp 0.8s ease-out",
            "pulse-slow": "pulse 3s ease-in-out infinite",
            glow: "glow 2s ease-in-out infinite alternate",
          },
        },
      },
    };
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
        .content-auto {
          content-visibility: auto;
        }
        .gradient-bg {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-shadow {
          box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
            0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .glow-effect {
          box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }
        .touch-friendly {
          min-height: 44px;
          min-width: 44px;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        .bilingual-title {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes glow {
        from {
          box-shadow: 0 0 15px rgba(114, 46, 209, 0.3);
        }
        to {
          box-shadow: 0 0 25px rgba(114, 46, 209, 0.6);
        }
      }

      .fortune-wheel {
        transition: transform 0.3s ease-in-out;
      }

      .fortune-wheel:hover {
        transform: rotate(5deg) scale(1.05);
      }

      .divine-text {
        background: linear-gradient(45deg, #7e57c2, #ab47bc);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .stage-card {
        transition: all 0.3s ease;
      }

      .stage-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }

      /* æ‰‹æœºç«¯ä¼˜åŒ– */
      body {
        font-size: 16px;
        line-height: 1.5;
      }

      .mobile-container {
        max-width: 600px;
        margin: 0 auto;
        padding: 0 16px;
      }

      .mobile-input {
        font-size: 16px;
        padding: 12px 16px;
        border-radius: 12px;
        border: 1px solid #ddd;
      }

      .mobile-button {
        font-size: 16px;
        padding: 12px 24px;
        border-radius: 12px;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .mobile-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      }

      /* åŒè¯­æ ·å¼ */
      .chinese-text {
        font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
        font-weight: 500;
      }

      .english-text {
        font-family: "Segoe UI", "Roboto", sans-serif;
        font-weight: 400;
        color: #666;
      }

      .bilingual-item {
        margin-bottom: 8px;
      }

      /* æ”¯ä»˜å¼¹çª—æ ·å¼ */
      .payment-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .payment-modal.active {
        opacity: 1;
        visibility: visible;
      }

      .payment-content {
        background: white;
        border-radius: 20px;
        padding: 32px;
        max-width: 90%;
        width: 400px;
        text-align: center;
        transform: translateY(20px);
        transition: transform 0.3s ease;
      }

      .payment-modal.active .payment-content {
        transform: translateY(0);
      }

      /* AIåˆ†æç»“æœæ ·å¼ */
      .ai-analysis {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        border-radius: 16px;
        padding: 24px;
        margin: 16px 0;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 20px auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
</head>

<body class="font-chinese bg-gradient-to-br from-slate-50 to-purple-50 min-h-screen">
  <!-- ä¸»å®¹å™¨ -->
  <div class="mobile-container">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="text-center mt-6 mb-6 animate-slide-up">
      <h1 class="text-3xl font-bold bilingual-title mb-2">
        é“é—¨ç§˜ä¼ å°å…­å£¬ä¹ç¥ç‰ˆ
      </h1>
      <p class="text-lg english-text">
        Daoist Secret Liu Ren Nine Gods Edition
      </p>
      <div class="w-24 h-1 bg-gradient-to-r from-primary to-secondary mx-auto mt-3 rounded-full"></div>
    </div>

    <!-- æ—¶é—´æ˜¾ç¤ºæ  -->
    <div class="mt-4 mb-6">
      <div class="bg-white rounded-2xl p-4 card-shadow animate-slide-up">
        <div class="flex justify-between items-center mb-2">
          <div class="text-center">
            <div class="text-sm text-gray-500 mb-1 english-text">Solar</div>
            <div class="text-sm text-gray-500 mb-1 chinese-text">é˜³å†</div>
            <div class="font-bold text-lg text-gray-800" id="solarDate">
              2025å¹´11æœˆ8æ—¥
            </div>
            <div class="text-sm text-gray-600" id="solarTime">14:30:00</div>
          </div>
          <div class="w-px h-12 bg-gray-200"></div>
          <div class="text-center">
            <div class="text-sm text-gray-500 mb-1 english-text">Lunar</div>
            <div class="text-sm text-gray-500 mb-1 chinese-text">é˜´å†</div>
            <div class="font-bold text-lg text-purple-600" id="lunarDate">
              ä¹™å·³å¹´ä¹æœˆåä¹
            </div>
            <div class="text-sm text-gray-600" id="lunarTime">æœªæ—¶</div>
          </div>
        </div>
      </div>
    </div>

    <!-- AIåœå¦è¯¢é—®æ¡† -->
    <div class="mb-6">
      <div class="bg-white rounded-2xl p-4 card-shadow animate-slide-up">
        <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center">
          <i class="fa fa-commenting-o mr-2 text-primary"></i>
          <span class="chinese-text">AIæ™ºèƒ½åœå¦</span>
          <span class="english-text ml-2 text-sm">AI Fortune Telling</span>
        </h3>
        <div class="space-y-3">
          <textarea id="questionInput" placeholder="è¯·è¾“å…¥æ‚¨æƒ³é¢„æµ‹çš„äº‹æƒ…ï¼Œä¾‹å¦‚ï¼š
1. æˆ‘æœ€è¿‘çš„å·¥ä½œè¿åŠ¿å¦‚ä½•ï¼Ÿ
2. è¿™ä»½æ„Ÿæƒ…èƒ½æœ‰å¥½ç»“æœå—ï¼Ÿ
3. æŠ•èµ„è¿™ä¸ªé¡¹ç›®ä¼šèµšé’±å—ï¼Ÿ

Please enter what you want to predict, e.g.:
1. How is my recent work fortune?
2. Will this relationship have a good result?
3. Will investing in this project make money?

ç³»ç»Ÿå°†æ ¹æ®å½“å‰æ—¶é—´ï¼ˆé˜³å†+é˜´å†+æ—¶è¾°ï¼‰è¿›è¡Œåœå¦ï¼Œé¢„æµ‹æœªæ¥å‘å±•è¶‹åŠ¿ã€‚
è¯·ç”¨æ¸…æ™°ç®€æ´çš„è¯­è¨€æè¿°æ‚¨æƒ³è¯¢é—®çš„å…·ä½“äº‹é¡¹ã€‚

The system will perform fortune telling based on the current time (solar + lunar + shichen) to predict future trends.
Please describe the specific matter you want to ask about in clear and concise language."
            class="mobile-input w-full h-40 resize-none focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
          <button onclick="startFortuneTelling()"
            class="mobile-button w-full bg-gradient-to-r from-primary to-secondary text-white touch-friendly">
            <i class="fa fa-magic mr-2"></i>
            <span class="chinese-text">å¼€å§‹åœå¦åˆ†æ</span>
            <span class="english-text ml-2">Start Fortune Telling</span>
            <span class="chinese-text ml-2">(1å…ƒ/æ¬¡)</span>
            <span class="english-text ml-1">(Â¥1/time)</span>
          </button>
          <p class="text-xs text-gray-500 text-center">
            <i class="fa fa-info-circle mr-1"></i>
            <span class="chinese-text">ç‚¹å‡»åå°†æ‰£é™¤1å…ƒï¼Œè·å¾—AIä¸“ä¸šåˆ†æç»“æœ</span>
            <span class="english-text ml-1">Click to deduct Â¥1 and get AI professional analysis
              results</span>
          </p>
        </div>
      </div>
    </div>

    <!-- åŠ è½½ä¸­çŠ¶æ€ -->
    <div id="loadingState" class="hidden mb-6">
      <div class="bg-white rounded-2xl p-6 card-shadow text-center">
        <div class="loading-spinner"></div>
        <p class="text-gray-600 mt-3">
          <span class="chinese-text">æ­£åœ¨ä¸ºæ‚¨åœå¦åˆ†æï¼Œè¯·ç¨å€™...</span>
          <span class="english-text ml-1">Analyzing your fortune, please wait...</span>
        </p>
        <p class="text-xs text-gray-500 mt-2">
          <span class="chinese-text">AIæ­£åœ¨è°ƒç”¨é“é—¨ä¹ç¥ç®—æ³•è¿›è¡Œæ·±åº¦åˆ†æ</span>
          <span class="english-text ml-1">AI is using Daoist Nine Gods algorithm for in-depth
            analysis</span>
        </p>
      </div>
    </div>

    <!-- AIåˆ†æç»“æœ -->
    <div id="aiResult" class="hidden mb-6">
      <div class="ai-analysis animate-slide-up">
        <h3 class="text-xl font-bold mb-4 flex items-center">
          <i class="fa fa-lightbulb-o mr-2"></i>
          <span class="chinese-text">AIæ™ºèƒ½åˆ†æç»“æœ</span>
          <span class="english-text ml-2">AI Intelligent Analysis Result</span>
        </h3>
        <div id="analysisContent"></div>
        <button onclick="clearAnalysis()" class="mt-4 bg-white text-primary px-4 py-2 rounded-lg text-sm font-semibold">
          <i class="fa fa-times mr-1"></i>
          <span class="chinese-text">é‡æ–°åœå¦</span>
          <span class="english-text ml-1">New Fortune Telling</span>
        </button>
      </div>
    </div>

    <!-- é“é—¨ä¹ç¥ä¸‰é˜¶æ®µé¢„æµ‹ - é»˜è®¤éšè— -->
    <div id="nineGodsPrediction" class="hidden mb-6">
      <div class="bg-white rounded-2xl p-6 card-shadow animate-slide-up">
        <h3 class="text-xl font-bold text-center divine-text mb-6">
          <i class="fa fa-diamond mr-2"></i>
          <span class="chinese-text">é“é—¨ä¹ç¥ä¸‰é˜¶æ®µé¢„æµ‹</span>
          <span class="english-text ml-2">Daoist Nine Gods Three-Stage Prediction</span>
        </h3>

        <!-- è®¡ç®—å‚æ•° -->
        <div class="bg-gray-50 rounded-lg p-3 mb-6 text-center">
          <div class="text-sm text-gray-600">
            <span class="chinese-text">å½“å‰è®¡ç®—å‚æ•°</span>
            <span class="english-text ml-1">Current Calculation Parameters</span>
          </div>
          <div class="text-sm font-semibold text-purple-600 mt-1" id="calcParams">
            å†œå†ä¹æœˆåä¹æœªæ—¶ (æœˆ:9, æ—¥:19, æ—¶:8)
            <br />
            Lunar September 19th, Weishi (Month:9, Day:19, Hour:8)
          </div>
        </div>

        <!-- ä¸‰é˜¶æ®µç»“æœ -->
        <div class="space-y-4">
          <!-- ç¬¬ä¸€é˜¶æ®µ -->
          <div class="stage-card bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-4 border border-green-200">
            <div class="flex items-center mb-3">
              <div
                class="w-16 h-16 bg-gradient-to-br from-green-500 to-blue-600 rounded-full flex items-center justify-center mr-4 fortune-wheel">
                <div class="text-white text-2xl font-bold" id="firstGodChar">
                  å¤©
                </div>
              </div>
              <div>
                <div class="text-xs text-green-600 font-semibold">
                  <span class="chinese-text">ç¬¬ä¸€é˜¶æ®µ Â· æœˆä¸Šèµ·æ•°</span>
                  <span class="english-text ml-1">Stage 1 Â· Moon Calculation</span>
                </div>
                <div class="text-xl font-bold text-gray-800" id="firstGodName">
                  å¤©å¾·
                </div>
                <div class="text-sm text-green-600 font-semibold" id="firstGodLuck">
                  å¤§å‰
                </div>
              </div>
            </div>
            <div class="bg-white rounded-lg p-3">
              <div class="text-xs text-gray-600 mb-1">
                <span class="chinese-text">æ–­æ›°ï¼š</span>
                <span class="english-text ml-1">Prediction:</span>
              </div>
              <div class="text-sm text-gray-700 leading-relaxed" id="firstGodDesc">
                å¤©å¾·è´µäººåŠ©ï¼Œé€¢å‡¶åŒ–å‰ç¥¥ï¼Œäº‹äº‹æœ‰äººå¸®ï¼Œé‡éš¾è´µäººç°ï¼Œæ±‚èŒé¡ºåˆ©æˆï¼Œäº¤æ˜“å¾—æˆåŠŸï¼Œç¥ˆç¦æ±‚å¹³å®‰ï¼Œç¦ç¦„è‡ªå¤©æ¥ã€‚
                <br /><br />
                Heavenly virtueè´µäºº helps, turns misfortune into good luck,
                everything has help, noble people appear in difficulties, job
                search goes smoothly, transactions succeed, pray for peace,
                fortune and blessings come from heaven.
              </div>
            </div>
          </div>

          <!-- ç¬¬äºŒé˜¶æ®µ -->
          <div class="stage-card bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-4 border border-purple-200">
            <div class="flex items-center mb-3">
              <div
                class="w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full flex items-center justify-center mr-4 fortune-wheel">
                <div class="text-white text-2xl font-bold" id="secondGodChar">
                  å¤©
                </div>
              </div>
              <div>
                <div class="text-xs text-purple-600 font-semibold">
                  <span class="chinese-text">ç¬¬äºŒé˜¶æ®µ Â· æ—¥ä¸Šèµ·æ•°</span>
                  <span class="english-text ml-1">Stage 2 Â· Sun Calculation</span>
                </div>
                <div class="text-xl font-bold text-gray-800" id="secondGodName">
                  å¤©å¾·
                </div>
                <div class="text-sm text-purple-600 font-semibold" id="secondGodLuck">
                  å¤§å‰
                </div>
              </div>
            </div>
            <div class="bg-white rounded-lg p-3">
              <div class="text-xs text-gray-600 mb-1">
                <span class="chinese-text">æ–­æ›°ï¼š</span>
                <span class="english-text ml-1">Prediction:</span>
              </div>
              <div class="text-sm text-gray-700 leading-relaxed" id="secondGodDesc">
                å¤©å¾·è´µäººåŠ©ï¼Œé€¢å‡¶åŒ–å‰ç¥¥ï¼Œäº‹äº‹æœ‰äººå¸®ï¼Œé‡éš¾è´µäººç°ï¼Œæ±‚èŒé¡ºåˆ©æˆï¼Œäº¤æ˜“å¾—æˆåŠŸï¼Œç¥ˆç¦æ±‚å¹³å®‰ï¼Œç¦ç¦„è‡ªå¤©æ¥ã€‚
                <br /><br />
                Heavenly virtue noble helps, turns misfortune into good luck,
                everything has help, noble people appear in difficulties, job
                search goes smoothly, transactions succeed, pray for peace,
                fortune and blessings come from heaven.
              </div>
            </div>
          </div>

          <!-- ç¬¬ä¸‰é˜¶æ®µ -->
          <div class="stage-card bg-gradient-to-r from-red-50 to-orange-50 rounded-xl p-4 border border-red-200">
            <div class="flex items-center mb-3">
              <div
                class="w-16 h-16 bg-gradient-to-br from-red-500 to-orange-600 rounded-full flex items-center justify-center mr-4 fortune-wheel">
                <div class="text-white text-2xl font-bold" id="thirdGodChar">
                  ç—…
                </div>
              </div>
              <div>
                <div class="text-xs text-red-600 font-semibold">
                  <span class="chinese-text">ç¬¬ä¸‰é˜¶æ®µ Â· æ—¶ä¸Šèµ·æ•°</span>
                  <span class="english-text ml-1">Stage 3 Â· Hour Calculation</span>
                </div>
                <div class="text-xl font-bold text-gray-800" id="thirdGodName">
                  ç—…ç¬¦
                </div>
                <div class="text-sm text-red-600 font-semibold" id="thirdGodLuck">
                  å‡¶
                </div>
              </div>
            </div>
            <div class="bg-white rounded-lg p-3">
              <div class="text-xs text-gray-600 mb-1">
                <span class="chinese-text">æ–­æ›°ï¼š</span>
                <span class="english-text ml-1">Prediction:</span>
              </div>
              <div class="text-sm text-gray-700 leading-relaxed" id="thirdGodDesc">
                ç—…ç¬¦ä¸»ç–¾ç—…ï¼Œèº«ä½“æ¬ å®‰åº·ï¼Œå‡¡äº‹å¤šé˜»ç¢ï¼ŒåŠäº‹ä¸é¡ºç•…ï¼Œå‡ºè¡Œå®œè°¨æ…ï¼Œäº¤æ˜“é˜²æŸä¼¤ï¼Œç¥ˆç¦ä¿å¹³å®‰ï¼Œæ¶ˆç¾ä¿å®‰åº·ã€‚
                <br /><br />
                Illness symbol indicates disease, poor health, many obstacles
                in everything, things don't go smoothly, travel with caution,
                prevent damage in transactions, pray for peace, eliminate
                disasters and ensure health.
              </div>
            </div>
          </div>
        </div>

        <!-- ç»¼åˆåˆ†æ -->
        <div class="mt-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-4">
          <h4 class="font-bold text-gray-800 mb-3 text-center">
            <i class="fa fa-lightbulb-o mr-2 text-yellow-500"></i>
            <span class="chinese-text">ç»¼åˆåˆ†æ</span>
            <span class="english-text ml-1">Comprehensive Analysis</span>
          </h4>
          <div class="space-y-3 text-sm">
            <div class="text-center">
              <div class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-semibold mb-1">
                <span class="chinese-text">åˆæœŸ</span>
                <span class="english-text ml-1">Initial Stage</span>
              </div>
              <div class="text-gray-600" id="firstAnalysis">
                æœ‰è´µäººç›¸åŠ©ï¼Œäº‹æƒ…å¼€å§‹é¡ºåˆ©
              </div>
              <div class="text-gray-600 text-xs" id="firstAnalysisEn">
                Noble people help, things start smoothly
              </div>
            </div>
            <div class="text-center">
              <div class="bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs font-semibold mb-1">
                <span class="chinese-text">ä¸­æœŸ</span>
                <span class="english-text ml-1">Middle Stage</span>
              </div>
              <div class="text-gray-600" id="secondAnalysis">
                è´µäººæŒç»­å¸®åŠ©ï¼Œè¿›å±•é¡ºåˆ©
              </div>
              <div class="text-gray-600 text-xs" id="secondAnalysisEn">
                Noble people continue to help, progress goes smoothly
              </div>
            </div>
            <div class="text-center">
              <div class="bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs font-semibold mb-1">
                <span class="chinese-text">åæœŸ</span>
                <span class="english-text ml-1">Final Stage</span>
              </div>
              <div class="text-gray-600" id="thirdAnalysis">
                éœ€è¦æ³¨æ„å¥åº·é—®é¢˜ï¼Œé˜²èŒƒç–¾ç—…
              </div>
              <div class="text-gray-600 text-xs" id="thirdAnalysisEn">
                Need to pay attention to health issues and prevent diseases
              </div>
            </div>
          </div>
          <div class="mt-4 p-3 bg-white rounded-lg">
            <div class="text-xs font-semibold text-gray-800 mb-1">
              <span class="chinese-text">æ•´ä½“ç»“è®ºï¼š</span>
              <span class="english-text ml-1">Overall Conclusion:</span>
            </div>
            <div class="text-sm text-gray-700 leading-relaxed" id="overallConclusion">
              æ•´ä½“æ¥çœ‹ï¼Œäº‹æƒ…å‘å±•å‰æœŸå’Œä¸­æœŸéƒ½æœ‰è´µäººç›¸åŠ©ï¼Œè¿›å±•é¡ºåˆ©ã€‚ä½†åœ¨åæœŸéœ€è¦ç‰¹åˆ«æ³¨æ„å¥åº·çŠ¶å†µï¼Œå»ºè®®æå‰åšå¥½é¢„é˜²æªæ–½ï¼Œä¿æŒè‰¯å¥½çš„ç”Ÿæ´»ä¹ æƒ¯ã€‚
              <br /><br />
              Overall, the development of things has noble people helping in
              the early and middle stages, and progress goes smoothly.
              However, in the later stage, special attention needs to be paid
              to health conditions. It is recommended to take preventive
              measures in advance and maintain good living habits.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- æ”¯ä»˜å¼¹çª— -->
  <div id="paymentModal" class="payment-modal">
    <div class="payment-content">
      <div class="text-4xl mb-4">ğŸ’°</div>
      <h3 class="text-xl font-bold text-gray-800 mb-2">
        <span class="chinese-text">ç¡®è®¤æ”¯ä»˜</span>
        <span class="english-text ml-1">Confirm Payment</span>
      </h3>
      <p class="text-gray-600 mb-6">
        <span class="chinese-text">æ‚¨å³å°†æ”¯ä»˜</span>
        <span class="english-text ml-1">You are about to pay</span>
        <span class="font-bold text-primary">1å…ƒ</span>
        <span class="chinese-text ml-1">è¿›è¡Œåœå¦åˆ†æ</span>
        <span class="english-text ml-1">for fortune telling analysis</span>
      </p>
      <div class="space-y-3">
        <button class="mobile-button w-full bg-success text-white touch-friendly">
          <i class="fa fa-check mr-2"></i>
          <span class="chinese-text confirm-btn">ç¡®è®¤æ”¯ä»˜</span>
          <span class="english-text ml-1">Confirm Payment</span>
        </button>
        <button onclick="cancelPayment()" class="mobile-button w-full bg-gray-200 text-gray-700 touch-friendly">
          <i class="fa fa-times mr-2"></i>
          <span class="chinese-text">å–æ¶ˆæ”¯ä»˜</span>
          <span class="english-text ml-1">Cancel Payment</span>
        </button>
      </div>
      <p class="text-xs text-gray-500 mt-4">
        <i class="fa fa-lock mr-1"></i>
        <span class="chinese-text">æ”¯ä»˜å®‰å…¨ï¼Œæ”¯æŒå¾®ä¿¡ã€æ”¯ä»˜å®</span>
        <span class="english-text ml-1">Secure payment, supports WeChat and Alipay</span>
      </p>
    </div>
  </div>

  <!-- é¡µè„š -->
  <footer class="bg-gray-800 text-white py-6 mt-8">
    <div class="mobile-container text-center">
      <p class="text-gray-400 text-sm mb-2">
        <i class="fa fa-yin-yang mr-2"></i>
        <span class="chinese-text">ä¼ æ‰¿é“å®¶æ–‡åŒ–ï¼Œå¼˜æ‰¬ä¼ ç»Ÿæ–‡åŒ–ç²¾é«“</span>
        <span class="english-text ml-1">Inheriting Daoist culture, promoting traditional cultural
          essence</span>
      </p>
      <p class="text-gray-500 text-xs">
        <span class="chinese-text">æœ¬åº”ç”¨ä»…ä¾›ä¼ ç»Ÿæ–‡åŒ–å­¦ä¹ ç ”ç©¶ï¼Œç»“æœä»…ä¾›å‚è€ƒ</span>
        <span class="english-text ml-1">This application is for traditional culture study and research
          only, results are for reference only</span>
      </p>
    </div>
  </footer>

  <script>
    // é“é—¨ä¹ç¥å®šä¹‰ - åŒè¯­ç‰ˆ
    const NINE_GODS = [
      {
        name: "å¤§å®‰",
        nameEn: "Da An",
        luck: "å¤§å‰",
        luckEn: "Great Auspicious",
        color: "text-green-600",
        bgColor: "bg-green-100",
        bgGradient: "from-green-500 to-blue-600",
        description:
          "å¤§å®‰äº‹äº‹æ˜Œï¼Œæ±‚è´¢åœ¨å¤æ–¹ï¼Œå¤±ç‰©å»ä¸è¿œï¼Œå®…èˆä¿å®‰åº·ï¼Œè¡Œäººèº«æœªåŠ¨ï¼Œç—…è€…ä¸»æ— å¦¨ï¼Œå°†å†›å›ç”°é‡ï¼Œä»”ç»†ä¸æ¨è¯¦ã€‚",
        descriptionEn:
          "Da An means everything prospers, seeking wealth in the southwest, lost items are not far, home is safe and healthy, travelers have not moved, patients are fine, general returns to the fields, carefully analyze.",
        meaning: "é™æ­¢ã€å¿ƒå®‰ã€å‰ç¥¥ï¼Œä¸»å®‰ç¨³æ— å¿§",
        meaningEn:
          "Static, peaceful, auspicious, mainly stable and worry-free",
      },
      {
        name: "ç•™è¿",
        nameEn: "Liu Lian",
        luck: "ä¸­å¹³",
        luckEn: "Medium Peace",
        color: "text-yellow-600",
        bgColor: "bg-yellow-100",
        bgGradient: "from-yellow-500 to-orange-600",
        description:
          "ç•™è¿äº‹éš¾æˆï¼Œæ±‚è°‹æ—¥æœªæ˜ï¼Œå®˜äº‹åªå®œç¼“ï¼Œå»è€…æœªå›ç¨‹ï¼Œå¤±ç‰©å—æ–¹è§ï¼Œæ€¥è®¨æ–¹ç§°å¿ƒï¼Œæ›´é¡»é˜²å£èˆŒï¼Œäººå£ä¸”å¹³å¹³ã€‚",
        descriptionEn:
          "Liu Lian means things are difficult to accomplish, plans are unclear, official matters should be delayed, those who left have not returned, lost items seen in south, urgent request to be satisfied, need to prevent disputes, people are average.",
        meaning: "æš—æ˜§ä¸æ˜ã€å»¶è¿Ÿã€çº ç¼ ã€æ‹–å»¶",
        meaningEn: "Ambiguous, delayed, entangled, procrastinated",
      },
      {
        name: "é€Ÿå–œ",
        nameEn: "Su Xi",
        luck: "å‰",
        luckEn: "Auspicious",
        color: "text-red-600",
        bgColor: "bg-red-100",
        bgGradient: "from-red-500 to-pink-600",
        description:
          "é€Ÿå–œå–œæ¥ä¸´ï¼Œæ±‚è´¢å‘å—è¡Œï¼Œå¤±ç‰©ç”³æœªåˆï¼Œé€¢äººè·¯ä¸Šå¯»ï¼Œå®˜äº‹æœ‰ç¦å¾·ï¼Œç—…è€…æ— ç¥¸ä¾µï¼Œç”°å®šå…­ç•œå‰ï¼Œè¡Œäººæœ‰ä¿¡éŸ³ã€‚",
        descriptionEn:
          "Su Xi means joy comes quickly, seek wealth by going south, lost items in afternoon, meet people on the road, official matters have blessing, patients have no misfortune, fields and livestock are auspicious, travelers have news.",
        meaning: "å¿«é€Ÿã€å–œåº†ã€å‰åˆ©ï¼Œæ—¶æœºå·²åˆ°",
        meaningEn: "Fast, festive, auspicious, the time has come",
      },
      {
        name: "èµ¤å£",
        nameEn: "Chi Kou",
        luck: "å‡¶",
        luckEn: "Inauspicious",
        color: "text-red-800",
        bgColor: "bg-red-100",
        bgGradient: "from-red-600 to-red-800",
        description:
          "èµ¤å£ä¸»å£èˆŒï¼Œå®˜éåˆ‡è¦é˜²ï¼Œå¤±ç‰©æ€¥å»å¯»ï¼Œè¡Œäººæœ‰æƒŠæ…Œï¼Œé¸¡çŠ¬å¤šä½œæ€ªï¼Œç—…è€…å‡ºè¥¿æ–¹ï¼Œæ›´é¡»é˜²å’’è¯…ï¼Œææ€•æŸ“ç˜Ÿç™€ã€‚",
        descriptionEn:
          "Chi Kou means disputes and arguments, need to prevent lawsuits, lost items need urgent search, travelers are alarmed, chickens and dogs act strangely, patients go west, need to prevent curses, afraid of gettingç˜Ÿç–«.",
        meaning: "ä¸å‰ã€æƒŠæã€å‡¶é™©ã€äº‰æ‰§",
        meaningEn: "Inauspicious, alarming, dangerous, dispute",
      },
      {
        name: "å°å‰",
        nameEn: "Xiao Ji",
        luck: "å‰",
        luckEn: "Auspicious",
        color: "text-blue-600",
        bgColor: "bg-blue-100",
        bgGradient: "from-blue-500 to-cyan-600",
        description:
          "å°å‰æœ€å‰æ˜Œï¼Œè·¯ä¸Šå¥½å•†é‡ï¼Œé˜´äººæ¥æŠ¥å–œï¼Œå¤±ç‰©åœ¨å¤æ–¹ï¼Œè¡Œäººç«‹ä¾¿è‡³ï¼Œäº¤å…³ç”šæ˜¯å¼ºï¼Œå‡¡äº‹çš†å’Œåˆï¼Œç—…è€…ç¥·ä¸Šè‹ã€‚",
        descriptionEn:
          "Xiao Ji means most auspicious, good to discuss on the road, women come to report good news, lost items in southwest, travelers arrive immediately, transactions are very strong, everything is harmonious, patients pray to heaven.",
        meaning: "å’Œåˆã€å‰åˆ©ã€å°æœ‰æ”¶è·",
        meaningEn: "Harmonious, auspicious, small harvest",
      },
      {
        name: "ç©ºäº¡",
        nameEn: "Kong Wang",
        luck: "å¤§å‡¶",
        luckEn: "Great Inauspicious",
        color: "text-gray-600",
        bgColor: "bg-gray-100",
        bgGradient: "from-gray-500 to-gray-700",
        description:
          "ç©ºäº¡äº‹ä¸é•¿ï¼Œé˜´äººå°ä¹–å¼ ï¼Œæ±‚è´¢æ— åˆ©ç›Šï¼Œè¡Œäººæœ‰ç¾æ®ƒï¼Œå¤±ç‰©å¯»ä¸è§ï¼Œå®˜äº‹æœ‰åˆ‘åœºï¼Œç—…äººé€¢æš—é¬¼ï¼Œç¦³è§£ä¿å®‰åº·ã€‚",
        descriptionEn:
          "Kong Wang means things don't last long, women are a bit unruly, seeking wealth has no benefit, travelers have disasters, lost items cannot be found, official matters have execution ground, patients meet dark ghosts, need to pray for peace and health.",
        meaning: "ä¸å‰ã€æ— ç»“æœã€å¿§è™‘ã€è™šç©º",
        meaningEn: "Inauspicious, no result, worry, empty",
      },
      {
        name: "ç—…ç¬¦",
        nameEn: "Bing Fu",
        luck: "å‡¶",
        luckEn: "Inauspicious",
        color: "text-purple-600",
        bgColor: "bg-purple-100",
        bgGradient: "from-purple-500 to-indigo-600",
        description:
          "ç—…ç¬¦ä¸»ç–¾ç—…ï¼Œèº«ä½“æ¬ å®‰åº·ï¼Œå‡¡äº‹å¤šé˜»ç¢ï¼ŒåŠäº‹ä¸é¡ºç•…ï¼Œå‡ºè¡Œå®œè°¨æ…ï¼Œäº¤æ˜“é˜²æŸä¼¤ï¼Œç¥ˆç¦ä¿å¹³å®‰ï¼Œæ¶ˆç¾ä¿å®‰åº·ã€‚",
        descriptionEn:
          "Bing Fu means illness, poor health, many obstacles in everything, things don't go smoothly, travel with caution, prevent damage in transactions, pray for peace, eliminate disasters and ensure health.",
        meaning: "ç—…æ€ã€å¼‚å¸¸ã€æ²»ç–—ï¼Œè¿‡ç¨‹éš¾å—ï¼Œäº‹æƒ…ä¸é¡ºåˆ©",
        meaningEn:
          "Pathological, abnormal, treatment, uncomfortable process, things not going well",
      },
      {
        name: "æ¡ƒèŠ±",
        nameEn: "Tao Hua",
        luck: "ä¸­å¹³",
        luckEn: "Medium Peace",
        color: "text-pink-600",
        bgColor: "bg-pink-100",
        bgGradient: "from-pink-500 to-rose-600",
        description:
          "æ¡ƒèŠ±ä¸»æƒ…ç¼˜ï¼Œå¼‚æ€§ç¼˜æ—ºç››ï¼Œå©šæ‹æœ‰æœºä¼šï¼Œäº¤å‹é¡»è°¨æ…ï¼Œé˜²çƒ‚æ¡ƒèŠ±ï¼Œç ´è´¢æ‹›æ˜¯éï¼Œæ­£ç¼˜å®œçæƒœï¼Œé‚ªç¼˜è¦è¿œç¦»ã€‚",
        descriptionEn:
          "Tao Hua means love and romance, strong opposite-sex attraction, marriage opportunities, need to be cautious in making friends, prevent bad relationships, lose money and cause trouble, cherish true love, stay away from evil relationships.",
        meaning: "æ¬²æœ›ã€ç‰µç»Šã€å¼‚æ€§ç›¸å…³ï¼Œé™¤æ‹çˆ±å©šå§»å¤–ï¼Œå å¾—ä¸å¤ªå¥½",
        meaningEn:
          "Desire, entanglement, related to opposite sex, not very good except for love and marriage",
      },
      {
        name: "å¤©å¾·",
        nameEn: "Tian De",
        luck: "å¤§å‰",
        luckEn: "Great Auspicious",
        color: "text-indigo-600",
        bgColor: "bg-indigo-100",
        bgGradient: "from-indigo-500 to-purple-600",
        description:
          "å¤©å¾·è´µäººåŠ©ï¼Œé€¢å‡¶åŒ–å‰ç¥¥ï¼Œäº‹äº‹æœ‰äººå¸®ï¼Œé‡éš¾è´µäººç°ï¼Œæ±‚èŒé¡ºåˆ©æˆï¼Œäº¤æ˜“å¾—æˆåŠŸï¼Œç¥ˆç¦æ±‚å¹³å®‰ï¼Œç¦ç¦„è‡ªå¤©æ¥ã€‚",
        descriptionEn:
          "Tian De means noble people help, turn misfortune into good luck, everything has help, noble people appear in difficulties, job search goes smoothly, transactions succeed, pray for peace, fortune and blessings come from heaven.",
        meaning: "è´µäººã€ä¸Šå¸ã€é«˜è¿œï¼Œæ±‚äººåŠäº‹æœ‰è´µäººç›¸åŠ©",
        meaningEn:
          "Noble person, superior, lofty, someone to help when asking for things",
      },
    ];

    // æ—¶è¾°å¯¹åº”è¡¨ - åŒè¯­ç‰ˆ
    const SHICHEN = [
      { name: "å­æ—¶", nameEn: "Zi Shi", period: "23:00-01:00" },
      { name: "ä¸‘æ—¶", nameEn: "Chou Shi", period: "01:00-03:00" },
      { name: "å¯…æ—¶", nameEn: "Yin Shi", period: "03:00-05:00" },
      { name: "å¯æ—¶", nameEn: "Mao Shi", period: "05:00-07:00" },
      { name: "è¾°æ—¶", nameEn: "Chen Shi", period: "07:00-09:00" },
      { name: "å·³æ—¶", nameEn: "Si Shi", period: "09:00-11:00" },
      { name: "åˆæ—¶", nameEn: "Wu Shi", period: "11:00-13:00" },
      { name: "æœªæ—¶", nameEn: "Wei Shi", period: "13:00-15:00" },
      { name: "ç”³æ—¶", nameEn: "Shen Shi", period: "15:00-17:00" },
      { name: "é…‰æ—¶", nameEn: "You Shi", period: "17:00-19:00" },
      { name: "æˆŒæ—¶", nameEn: "Xu Shi", period: "19:00-21:00" },
      { name: "äº¥æ—¶", nameEn: "Hai Shi", period: "21:00-23:00" },
    ];

    // 2025å¹´å†œå†ä¹æœˆè¯¦ç»†å¯¹ç…§è¡¨
    const LUNAR_2025_SEPTEMBER = {
      "2025-10-21": {
        month: 9,
        day: 1,
        monthName: "ä¹æœˆ",
        dayName: "åˆä¸€",
        monthNameEn: "September",
        dayNameEn: "1st",
      },
      "2025-10-22": {
        month: 9,
        day: 2,
        monthName: "ä¹æœˆ",
        dayName: "åˆäºŒ",
        monthNameEn: "September",
        dayNameEn: "2nd",
      },
      "2025-10-23": {
        month: 9,
        day: 3,
        monthName: "ä¹æœˆ",
        dayName: "åˆä¸‰",
        monthNameEn: "September",
        dayNameEn: "3rd",
      },
      "2025-10-24": {
        month: 9,
        day: 4,
        monthName: "ä¹æœˆ",
        dayName: "åˆå››",
        monthNameEn: "September",
        dayNameEn: "4th",
      },
      "2025-10-25": {
        month: 9,
        day: 5,
        monthName: "ä¹æœˆ",
        dayName: "åˆäº”",
        monthNameEn: "September",
        dayNameEn: "5th",
      },
      "2025-10-26": {
        month: 9,
        day: 6,
        monthName: "ä¹æœˆ",
        dayName: "åˆå…­",
        monthNameEn: "September",
        dayNameEn: "6th",
      },
      "2025-10-27": {
        month: 9,
        day: 7,
        monthName: "ä¹æœˆ",
        dayName: "åˆä¸ƒ",
        monthNameEn: "September",
        dayNameEn: "7th",
      },
      "2025-10-28": {
        month: 9,
        day: 8,
        monthName: "ä¹æœˆ",
        dayName: "åˆå…«",
        monthNameEn: "September",
        dayNameEn: "8th",
      },
      "2025-10-29": {
        month: 9,
        day: 9,
        monthName: "ä¹æœˆ",
        dayName: "åˆä¹",
        monthNameEn: "September",
        dayNameEn: "9th",
      },
      "2025-10-30": {
        month: 9,
        day: 10,
        monthName: "ä¹æœˆ",
        dayName: "åˆå",
        monthNameEn: "September",
        dayNameEn: "10th",
      },
      "2025-10-31": {
        month: 9,
        day: 11,
        monthName: "ä¹æœˆ",
        dayName: "åä¸€",
        monthNameEn: "September",
        dayNameEn: "11th",
      },
      "2025-11-01": {
        month: 9,
        day: 12,
        monthName: "ä¹æœˆ",
        dayName: "åäºŒ",
        monthNameEn: "September",
        dayNameEn: "12th",
      },
      "2025-11-02": {
        month: 9,
        day: 13,
        monthName: "ä¹æœˆ",
        dayName: "åä¸‰",
        monthNameEn: "September",
        dayNameEn: "13th",
      },
      "2025-11-03": {
        month: 9,
        day: 14,
        monthName: "ä¹æœˆ",
        dayName: "åå››",
        monthNameEn: "September",
        dayNameEn: "14th",
      },
      "2025-11-04": {
        month: 9,
        day: 15,
        monthName: "ä¹æœˆ",
        dayName: "åäº”",
        monthNameEn: "September",
        dayNameEn: "15th",
      },
      "2025-11-05": {
        month: 9,
        day: 16,
        monthName: "ä¹æœˆ",
        dayName: "åå…­",
        monthNameEn: "September",
        dayNameEn: "16th",
      },
      "2025-11-06": {
        month: 9,
        day: 17,
        monthName: "ä¹æœˆ",
        dayName: "åä¸ƒ",
        monthNameEn: "September",
        dayNameEn: "17th",
      },
      "2025-11-07": {
        month: 9,
        day: 18,
        monthName: "ä¹æœˆ",
        dayName: "åå…«",
        monthNameEn: "September",
        dayNameEn: "18th",
      },
      "2025-11-08": {
        month: 9,
        day: 19,
        monthName: "ä¹æœˆ",
        dayName: "åä¹",
        monthNameEn: "September",
        dayNameEn: "19th",
      },
      "2025-11-09": {
        month: 9,
        day: 20,
        monthName: "ä¹æœˆ",
        dayName: "äºŒå",
        monthNameEn: "September",
        dayNameEn: "20th",
      },
      "2025-11-10": {
        month: 9,
        day: 21,
        monthName: "ä¹æœˆ",
        dayName: "å»¿ä¸€",
        monthNameEn: "September",
        dayNameEn: "21st",
      },
      "2025-11-11": {
        month: 9,
        day: 22,
        monthName: "ä¹æœˆ",
        dayName: "å»¿äºŒ",
        monthNameEn: "September",
        dayNameEn: "22nd",
      },
      "2025-11-12": {
        month: 9,
        day: 23,
        monthName: "ä¹æœˆ",
        dayName: "å»¿ä¸‰",
        monthNameEn: "September",
        dayNameEn: "23rd",
      },
      "2025-11-13": {
        month: 9,
        day: 24,
        monthName: "ä¹æœˆ",
        dayName: "å»¿å››",
        monthNameEn: "September",
        dayNameEn: "24th",
      },
      "2025-11-14": {
        month: 9,
        day: 25,
        monthName: "ä¹æœˆ",
        dayName: "å»¿äº”",
        monthNameEn: "September",
        dayNameEn: "25th",
      },
      "2025-11-15": {
        month: 9,
        day: 26,
        monthName: "ä¹æœˆ",
        dayName: "å»¿å…­",
        monthNameEn: "September",
        dayNameEn: "26th",
      },
      "2025-11-16": {
        month: 9,
        day: 27,
        monthName: "ä¹æœˆ",
        dayName: "å»¿ä¸ƒ",
        monthNameEn: "September",
        dayNameEn: "27th",
      },
      "2025-11-17": {
        month: 9,
        day: 28,
        monthName: "ä¹æœˆ",
        dayName: "å»¿å…«",
        monthNameEn: "September",
        dayNameEn: "28th",
      },
      "2025-11-18": {
        month: 9,
        day: 29,
        monthName: "ä¹æœˆ",
        dayName: "å»¿ä¹",
        monthNameEn: "September",
        dayNameEn: "29th",
      },
      "2025-11-19": {
        month: 9,
        day: 30,
        monthName: "ä¹æœˆ",
        dayName: "ä¸‰å",
        monthNameEn: "September",
        dayNameEn: "30th",
      },
    };

    // å†œå†è½¬æ¢å‡½æ•°
    function convertSolarToLunar(date) {
      const dateStr = date.toISOString().split("T")[0];

      if (LUNAR_2025_SEPTEMBER[dateStr]) {
        const lunar = LUNAR_2025_SEPTEMBER[dateStr];
        return {
          year: 2025,
          month: lunar.monthName,
          monthEn: lunar.monthNameEn,
          day: lunar.dayName,
          dayEn: lunar.dayNameEn,
          monthNum: lunar.month,
          dayNum: lunar.day,
        };
      }

      // ç®€åŒ–çš„å†œå†è®¡ç®—
      const year = date.getFullYear();
      const month = date.getMonth() + 1;
      const day = date.getDate();

      const lunarMonths = [
        "æ­£æœˆ",
        "äºŒæœˆ",
        "ä¸‰æœˆ",
        "å››æœˆ",
        "äº”æœˆ",
        "å…­æœˆ",
        "ä¸ƒæœˆ",
        "å…«æœˆ",
        "ä¹æœˆ",
        "åæœˆ",
        "å†¬æœˆ",
        "è…Šæœˆ",
      ];
      const lunarMonthsEn = [
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December",
      ];
      const lunarDays = [
        "åˆä¸€",
        "åˆäºŒ",
        "åˆä¸‰",
        "åˆå››",
        "åˆäº”",
        "åˆå…­",
        "åˆä¸ƒ",
        "åˆå…«",
        "åˆä¹",
        "åˆå",
        "åä¸€",
        "åäºŒ",
        "åä¸‰",
        "åå››",
        "åäº”",
        "åå…­",
        "åä¸ƒ",
        "åå…«",
        "åä¹",
        "äºŒå",
        "å»¿ä¸€",
        "å»¿äºŒ",
        "å»¿ä¸‰",
        "å»¿å››",
        "å»¿äº”",
        "å»¿å…­",
        "å»¿ä¸ƒ",
        "å»¿å…«",
        "å»¿ä¹",
        "ä¸‰å",
      ];
      const lunarDaysEn = [
        "1st",
        "2nd",
        "3rd",
        "4th",
        "5th",
        "6th",
        "7th",
        "8th",
        "9th",
        "10th",
        "11th",
        "12th",
        "13th",
        "14th",
        "15th",
        "16th",
        "17th",
        "18th",
        "19th",
        "20th",
        "21st",
        "22nd",
        "23rd",
        "24th",
        "25th",
        "26th",
        "27th",
        "28th",
        "29th",
        "30th",
      ];

      let lunarMonth = (month + 2) % 12;
      if (lunarMonth === 0) lunarMonth = 12;

      let lunarDay = (day + 10) % 30;
      if (lunarDay === 0) lunarDay = 30;

      return {
        year: year,
        month: lunarMonths[lunarMonth - 1],
        monthEn: lunarMonthsEn[lunarMonth - 1],
        day: lunarDays[lunarDay - 1],
        dayEn: lunarDaysEn[lunarDay - 1],
        monthNum: lunarMonth,
        dayNum: lunarDay,
      };
    }

    // è®¡ç®—æ—¶è¾°
    function getShichenInfo(date) {
      const hour = date.getHours();
      const shichenIndex = Math.floor((hour + 1) / 2);
      const shichen = SHICHEN[shichenIndex];

      return {
        index: shichenIndex,
        name: shichen?.name,
        nameEn: shichen?.nameEn,
        period: shichen?.period,
        number: shichenIndex + 1,
      };
    }

    // é“é—¨ä¹ç¥ä¸‰é˜¶æ®µç®—æ³•
    function calculateNineGodStages(lunarMonth, lunarDay, shichenNumber) {
      // ç¬¬ä¸€é˜¶æ®µï¼šæœˆä¸Šèµ·æ•°
      let firstIndex = (lunarMonth - 1) % 9;
      const firstGod = NINE_GODS[firstIndex];

      // ç¬¬äºŒé˜¶æ®µï¼šä»¥ä¸Šä¸€é˜¶æ®µç»“æœä¸ºèµ·ç‚¹ï¼Œæ—¥ä¸Šèµ·æ•°
      let secondIndex = (firstIndex + lunarDay - 1) % 9;
      const secondGod = NINE_GODS[secondIndex];

      // ç¬¬ä¸‰é˜¶æ®µï¼šä»¥ä¸Šä¸€é˜¶æ®µç»“æœä¸ºèµ·ç‚¹ï¼Œæ—¶ä¸Šèµ·æ•°
      let thirdIndex = (secondIndex + shichenNumber - 1) % 9;
      const thirdGod = NINE_GODS[thirdIndex];

      return [firstGod, secondGod, thirdGod];
    }

    // æ›´æ–°æ˜¾ç¤º
    function updateDisplay() {
      const now = new Date();

      // æ›´æ–°é˜³å†æ˜¾ç¤º
      document.getElementById("solarDate").textContent =
        now.toLocaleDateString("zh-CN");
      document.getElementById("solarTime").textContent = now
        .toLocaleTimeString("zh-CN")
        .slice(0, 8);

      // è½¬æ¢å†œå†
      const lunar = convertSolarToLunar(now);
      document.getElementById(
        "lunarDate"
      ).textContent = `${lunar.year}å¹´${lunar.month}${lunar.day}`;

      // è®¡ç®—æ—¶è¾°
      const shichen = getShichenInfo(now);
      document.getElementById(
        "lunarTime"
      ).textContent = `${shichen.name} (${shichen.period})`;

      // æ˜¾ç¤ºè®¡ç®—å‚æ•°
      document.getElementById(
        "calcParams"
      ).innerHTML = `å†œå†${lunar.month}${lunar.day}${shichen.name} (æœˆ:${lunar.monthNum}, æ—¥:${lunar.dayNum}, æ—¶:${shichen.number})
                <br>
                Lunar ${lunar.monthEn} ${lunar.dayEn}, ${shichen.nameEn} (Month:${lunar.monthNum}, Day:${lunar.dayNum}, Hour:${shichen.number})`;

      // è®¡ç®—ä¹ç¥ä¸‰é˜¶æ®µç»“æœ
      const stages = calculateNineGodStages(
        lunar.monthNum,
        lunar.dayNum,
        shichen.number
      );

      // æ›´æ–°ä¸‰ç¥æ˜¾ç¤º
      updateStageDisplay(1, stages[0]);
      updateStageDisplay(2, stages[1]);
      updateStageDisplay(3, stages[2]);

      // ç”Ÿæˆåˆ†æ
      const analyses = generateAnalysis(stages);
      document.getElementById("firstAnalysis").textContent =
        analyses[0].conclusion;
      document.getElementById("firstAnalysisEn").textContent =
        analyses[0].conclusionEn;
      document.getElementById("secondAnalysis").textContent =
        analyses[1].conclusion;
      document.getElementById("secondAnalysisEn").textContent =
        analyses[1].conclusionEn;
      document.getElementById("thirdAnalysis").textContent =
        analyses[2].conclusion;
      document.getElementById("thirdAnalysisEn").textContent =
        analyses[2].conclusionEn;

      // ç”Ÿæˆæ•´ä½“ç»“è®º
      const overallConclusion = generateOverallConclusion(stages);
      document.getElementById("overallConclusion").innerHTML =
        overallConclusion;

      return stages;
    }

    // æ›´æ–°é˜¶æ®µæ˜¾ç¤º
    function updateStageDisplay(stageNum, god) {
      const prefix =
        stageNum === 1 ? "first" : stageNum === 2 ? "second" : "third";

      document.getElementById(`${prefix}GodChar`).textContent =
        god.name.charAt(0);
      document.getElementById(
        `${prefix}GodName`
      ).innerHTML = `${god.name} <span class="text-sm text-gray-500">${god.nameEn}</span>`;
      document.getElementById(
        `${prefix}GodLuck`
      ).innerHTML = `${god.luck} <span class="text-sm text-gray-500">${god.luckEn}</span>`;
      document.getElementById(
        `${prefix}GodDesc`
      ).innerHTML = `${god.description}<br><br>${god.descriptionEn}`;
    }

    // ç”Ÿæˆç»¼åˆåˆ†æ
    function generateAnalysis(stages) {
      const analyses = [];

      stages.forEach((stage, index) => {
        let analysis = "";
        let analysisEn = "";
        let conclusion = "";
        let conclusionEn = "";
        const stageName =
          index === 0 ? "åˆæœŸ" : index === 1 ? "ä¸­æœŸ" : "åæœŸ";
        const stageNameEn =
          index === 0
            ? "Initial Stage"
            : index === 1
              ? "Middle Stage"
              : "Final Stage";

        switch (stage.name) {
          case "å¤§å®‰":
            analysis = "äº‹æƒ…å®‰ç¨³é¡ºåˆ©ï¼Œæ²¡æœ‰å˜åŠ¨ï¼Œå¹³å®‰å‰ç¥¥";
            analysisEn =
              "Things are stable and smooth, no changes, peaceful and auspicious";
            conclusion = `${stageName}åŸºç¡€ç¨³å›ºï¼Œè¿›å±•é¡ºåˆ©`;
            conclusionEn = `${stageNameEn} foundation is solid, progress is smooth`;
            break;
          case "ç•™è¿":
            analysis = "äº‹æƒ…ä¼šæœ‰å»¶è¿Ÿï¼Œéœ€è¦è€å¿ƒç­‰å¾…ï¼Œå¯èƒ½æœ‰çº ç¼ ";
            analysisEn =
              "Things will be delayed, need patience, may have entanglement";
            conclusion = `${stageName}è¿›å±•ç¼“æ…¢ï¼Œéœ€è¦è€å¿ƒåšæŒ`;
            conclusionEn = `${stageNameEn} progress is slow, need patience and persistence`;
            break;
          case "é€Ÿå–œ":
            analysis = "å–œäº‹ä¸´é—¨ï¼Œè¿›å±•è¿…é€Ÿï¼Œæ—¶æœºæ­£å¥½";
            analysisEn =
              "Happy events arrive, progress is rapid, timing is right";
            conclusion = "å‘å±•è¿…é€Ÿï¼Œæœ‰å¥½æ¶ˆæ¯ä¼ æ¥";
            conclusionEn = "Developing rapidly, good news is coming";
            break;
          case "èµ¤å£":
            analysis = "è¦æ³¨æ„å£èˆŒæ˜¯éï¼Œå¯èƒ½æœ‰äº‰æ‰§ï¼Œéœ€è¦è°¨æ…";
            analysisEn =
              "Need to pay attention to disputes, may have arguments, need caution";
            conclusion = "éœ€è¦æ³¨æ„äººé™…å…³ç³»ï¼Œé¿å…å†²çª";
            conclusionEn =
              "Need to pay attention to interpersonal relationships, avoid conflicts";
            break;
          case "å°å‰":
            analysis = "å°æœ‰å‰åˆ©ï¼Œäº‹æƒ…å°šå¯ï¼Œä¼šæœ‰æ”¶è·";
            analysisEn =
              "Small auspiciousness, things are okay, there will be gains";
            conclusion = "æ•´ä½“å‘å¥½ï¼Œä¼šæœ‰å°çš„æ”¶è·";
            conclusionEn = "Overall positive, there will be small gains";
            break;
          case "ç©ºäº¡":
            analysis = "äº‹æƒ…å¯èƒ½æ— æœè€Œç»ˆï¼Œæˆ–è€…æœ‰è™šç©ºä¸å®çš„æƒ…å†µ";
            analysisEn =
              "Things may end without result, or have empty and unrealistic situations";
            conclusion = "éœ€è¦é‡æ–°è¯„ä¼°ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´ç­–ç•¥";
            conclusionEn = "Need to re-evaluate, may need to adjust strategy";
            break;
          case "ç—…ç¬¦":
            analysis = "è¦æ³¨æ„å¥åº·é—®é¢˜ï¼Œå¯èƒ½æœ‰ç–¾ç—…å›°æ‰°ï¼Œéœ€è¦é¢„é˜²";
            analysisEn =
              "Need to pay attention to health issues, may have illness troubles, need prevention";
            conclusion = "ç‰¹åˆ«æ³¨æ„èº«ä½“å¥åº·ï¼Œåšå¥½é¢„é˜²æªæ–½";
            conclusionEn =
              "Special attention to health, take preventive measures";
            break;
          case "æ¡ƒèŠ±":
            analysis = "å¼‚æ€§ç¼˜æ—ºï¼Œå¯èƒ½æœ‰æ„Ÿæƒ…æœºä¼šï¼Œä½†ä¹Ÿè¦é˜²çƒ‚æ¡ƒèŠ±";
            analysisEn =
              "Strong opposite-sex attraction, may have relationship opportunities, but also need to prevent bad relationships";
            conclusion = "æ³¨æ„æ„Ÿæƒ…ç”Ÿæ´»ï¼ŒæŠŠæ¡å¥½åˆ†å¯¸";
            conclusionEn =
              "Pay attention to emotional life, grasp the proper measure";
            break;
          case "å¤©å¾·":
            analysis = "æœ‰è´µäººç›¸åŠ©ï¼Œé€¢å‡¶åŒ–å‰ï¼Œäº‹äº‹é¡ºåˆ©";
            analysisEn =
              "Have noble people to help, turn misfortune into good luck, everything goes smoothly";
            conclusion = "æœ‰è´µäººå¸®åŠ©ï¼Œäº‹æƒ…ä¼šé¡ºåˆ©è§£å†³";
            conclusionEn =
              "Have noble people to help, things will be solved smoothly";
            break;
        }

        analyses.push({
          stage: index + 1,
          god: stage.name,
          analysis: analysis,
          analysisEn: analysisEn,
          conclusion: conclusion,
          conclusionEn: conclusionEn,
        });
      });

      return analyses;
    }

    // ç”Ÿæˆæ•´ä½“ç»“è®º
    function generateOverallConclusion(stages) {
      const goodGods = stages.filter((god) =>
        ["å¤§å®‰", "é€Ÿå–œ", "å°å‰", "å¤©å¾·"].includes(god.name)
      ).length;
      const badGods = stages.filter((god) =>
        ["èµ¤å£", "ç©ºäº¡", "ç—…ç¬¦"].includes(god.name)
      ).length;

      let conclusion = "";
      let conclusionEn = "";

      if (goodGods === 3) {
        conclusion =
          "æ­å–œï¼ä¸‰ä¸ªé˜¶æ®µéƒ½æ˜¾ç¤ºå‰åˆ©ï¼Œäº‹æƒ…æ•´ä½“å‘å±•éå¸¸é¡ºåˆ©ï¼Œä¼šæœ‰å¾ˆå¥½çš„ç»“æœã€‚";
        conclusionEn =
          "Congratulations! All three stages show auspiciousness, the overall development of things is very smooth, and there will be good results.";
      } else if (goodGods >= 2) {
        conclusion =
          "æ•´ä½“æ¥çœ‹äº‹æƒ…å‘å±•è¾ƒå¥½ï¼Œè™½ç„¶æœ‰ä¸€äº›å°æ³¢æŠ˜ï¼Œä½†æœ€ç»ˆä¼šæœ‰å¥½çš„ç»“æœã€‚";
        conclusionEn =
          "Overall, things are developing well. Although there are some small twists and turns, there will eventually be good results.";
      } else if (badGods >= 2) {
        conclusion =
          "äº‹æƒ…å‘å±•å¯èƒ½ä¼šé‡åˆ°ä¸€äº›å›°éš¾å’ŒæŒ‘æˆ˜ï¼Œéœ€è¦è°¨æ…åº”å¯¹ï¼Œåšå¥½å……åˆ†å‡†å¤‡ã€‚";
        conclusionEn =
          "The development of things may encounter some difficulties and challenges, need to deal with caution and make full preparations.";
      } else if (stages.some((god) => god.name === "å¤©å¾·")) {
        conclusion = "è™½ç„¶è¿‡ç¨‹ä¸­æœ‰ä¸€äº›èµ·ä¼ï¼Œä½†æœ‰è´µäººç›¸åŠ©ï¼Œæœ€ç»ˆèƒ½å¤Ÿé€¢å‡¶åŒ–å‰ã€‚";
        conclusionEn =
          "Although there are some ups and downs in the process, with the help of noble people, we can eventually turn misfortune into good luck.";
      } else if (stages.some((god) => god.name === "ç—…ç¬¦")) {
        conclusion = "ç‰¹åˆ«è¦æ³¨æ„å¥åº·é—®é¢˜ï¼Œå…¶ä»–æ–¹é¢å‘å±•å°šå¯ï¼Œä½†å¥åº·æ˜¯å…³é”®ã€‚";
        conclusionEn =
          "Special attention should be paid to health issues. Other aspects are developing well, but health is the key.";
      } else {
        conclusion =
          "äº‹æƒ…å‘å±•æœ‰èµ·æœ‰ä¼ï¼Œéœ€è¦æ ¹æ®å…·ä½“æƒ…å†µçµæ´»åº”å¯¹ï¼Œä¿æŒç§¯æå¿ƒæ€ã€‚";
        conclusionEn =
          "The development of things has ups and downs, need to deal with flexibility according to specific situations and maintain a positive attitude.";
      }

      return `${conclusion}<br><br>${conclusionEn}`;
    }

    // AIåœå¦ç›¸å…³å‡½æ•°
    let currentQuestion = "";

    function startFortuneTelling() {
      currentQuestion = document.getElementById("questionInput").value.trim();

      if (!currentQuestion) {
        alert(
          "è¯·è¾“å…¥æ‚¨æƒ³è¯¢é—®çš„äº‹é¡¹\nPlease enter what you want to ask about"
        );
        return;
      }

      // æ˜¾ç¤ºæ”¯ä»˜ç¡®è®¤å¼¹çª—
      document.getElementById("paymentModal").classList.add("active");
    }

    function confirmPayment() {
      // éšè—æ”¯ä»˜å¼¹çª—
      document.getElementById("paymentModal").classList.remove("active");

      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      document.getElementById("loadingState").classList.remove("hidden");
      document.getElementById("aiResult").classList.add("hidden");

      // æ¨¡æ‹Ÿæ”¯ä»˜å’ŒAIåˆ†æè¿‡ç¨‹
      setTimeout(() => {
        // æ¨¡æ‹Ÿæ”¯ä»˜æˆåŠŸ
        simulatePaymentSuccess();

        // è°ƒç”¨AI APIè¿›è¡Œåˆ†æ
        callAIApiForAnalysis();
      }, 1000);
    }

    function cancelPayment() {
      document.getElementById("paymentModal").classList.remove("active");
    }

    function simulatePaymentSuccess() {
      console.log(
        "æ”¯ä»˜æˆåŠŸï¼Œå¼€å§‹AIåˆ†æ...\nPayment successful, starting AI analysis..."
      );
    }

    // è°ƒç”¨AI APIè¿›è¡Œåˆ†æ
    async function callAIApiForAnalysis() {
      try {
        const now = new Date();
        const lunar = convertSolarToLunar(now);
        const shichen = getShichenInfo(now);
        const stages = calculateNineGodStages(
          lunar.monthNum,
          lunar.dayNum,
          shichen.number
        );

        // å‡†å¤‡APIè¯·æ±‚æ•°æ®
        const apiUrl = "https://api.siliconflow.cn/v1/chat/completions";
        const token = "sk-zhkdhbaohshweaxxzxlvvucvklmlwsepbzmmghkxxkrfwpli"; // ä½¿ç”¨ç”¨æˆ·æä¾›çš„APIå¯†é’¥

        const messages = [
          {
            role: "system",
            content: `ä½ æ˜¯ä¸€ä½ç²¾é€šé“é—¨ä¹ç¥å°å…­å£¬ç®—æ³•çš„AIå åœå¸ˆã€‚è¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯ä¸ºç”¨æˆ·æä¾›ä¸“ä¸šçš„åœå¦åˆ†æï¼š
                        
å½“å‰æ—¶é—´ï¼š
- é˜³å†ï¼š${now.toLocaleDateString("zh-CN")} ${now.toLocaleTimeString("zh-CN")}
- é˜´å†ï¼š${lunar.year}å¹´${lunar.month}${lunar.day}${shichen.name}
- è®¡ç®—å‚æ•°ï¼šæœˆ${lunar.monthNum}ï¼Œæ—¥${lunar.dayNum}ï¼Œæ—¶${shichen.number}

Current Time:
- Solar: ${now.toLocaleDateString("en-US")} ${now.toLocaleTimeString("en-US")}
- Lunar: ${lunar.year} Year ${lunar.month} ${lunar.day}, ${shichen.name}
- Calculation Parameters: Month ${lunar.monthNum}, Day ${lunar.dayNum}, Hour ${shichen.number
              }

é“é—¨ä¹ç¥ä¸‰é˜¶æ®µç»“æœï¼š
1. ç¬¬ä¸€é˜¶æ®µï¼ˆæœˆä¸Šèµ·æ•°ï¼‰ï¼š${stages[0].name} (${stages[0].nameEn}) - ${stages[0].meaning
              }
   æ–­æ›°ï¼š${stages[0].description}
   
2. ç¬¬äºŒé˜¶æ®µï¼ˆæ—¥ä¸Šèµ·æ•°ï¼‰ï¼š${stages[1].name} (${stages[1].nameEn}) - ${stages[1].meaning
              }
   æ–­æ›°ï¼š${stages[1].description}
   
3. ç¬¬ä¸‰é˜¶æ®µï¼ˆæ—¶ä¸Šèµ·æ•°ï¼‰ï¼š${stages[2].name} (${stages[2].nameEn}) - ${stages[2].meaning
              }
   æ–­æ›°ï¼š${stages[2].description}

Nine Gods Three-Stage Results:
1. Stage 1 (Moon Calculation): ${stages[0].name} (${stages[0].nameEn}) - ${stages[0].meaningEn
              }
   Prediction: ${stages[0].descriptionEn}
   
2. Stage 2 (Sun Calculation): ${stages[1].name} (${stages[1].nameEn}) - ${stages[1].meaningEn
              }
   Prediction: ${stages[1].descriptionEn}
   
3. Stage 3 (Hour Calculation): ${stages[2].name} (${stages[2].nameEn}) - ${stages[2].meaningEn
              }
   Prediction: ${stages[2].descriptionEn}

åˆ†æè¦æ±‚ï¼š
1. é’ˆå¯¹ç”¨æˆ·çš„å…·ä½“é—®é¢˜è¿›è¡Œæ·±å…¥åˆ†æ
2. ç»“åˆé“é—¨ä¹ç¥ç®—æ³•çš„ä¸“ä¸šæœ¯è¯­
3. æä¾›è¯¦ç»†çš„å‰å‡¶åˆ¤æ–­å’Œå‘å±•è¶‹åŠ¿é¢„æµ‹
4. ç»™å‡ºå®ç”¨çš„å»ºè®®å’Œæ³¨æ„äº‹é¡¹
5. è¯­è¨€è¦ä¸“ä¸šä½†æ˜“æ‡‚ï¼Œç¬¦åˆä¼ ç»Ÿæ–‡åŒ–çš„è¡¨è¾¾æ–¹å¼

Analysis Requirements:
1. Conduct in-depth analysis of the user's specific question
2. Combine professional terminology of Daoist Nine Gods algorithm
3. Provide detailed auspicious/inauspicious judgment and development trend prediction
4. Give practical suggestions and precautions
5. Language should be professional but easy to understand, in line with traditional cultural expression

è¯·ä»¥ä¸“ä¸šå åœå¸ˆçš„èº«ä»½ï¼Œç»™å‡ºå…¨é¢ã€å‡†ç¡®çš„åˆ†æç»“æœã€‚

Please provide comprehensive and accurate analysis results as a professional fortune teller.

é‡è¦ï¼šè¯·ä½¿ç”¨åŒè¯­å›ç­”ï¼Œå…ˆä¸­æ–‡åè‹±æ–‡ï¼Œç”¨<br><br>åˆ†éš”ã€‚
Important: Please answer in bilingual, Chinese first then English, separated by <br><br>.`,
          },
          {
            role: "user",
            content: currentQuestion,
          },
        ];

        // å‘é€APIè¯·æ±‚
        const response = await fetch(apiUrl, {
          method: "POST",
          headers: {
            Authorization: `Bearer ${token}`,
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            model: "Qwen/QwQ-32B",
            messages: messages,
            temperature: 0.7,
            max_tokens: 1500,
          }),
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(
            `APIè¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText
            } - ${JSON.stringify(errorData)}`
          );
        }

        const data = await response.json();
        console.log("APIå“åº”:", data);

        if (
          data.choices &&
          data.choices[0] &&
          data.choices[0].message &&
          data.choices[0].message.content
        ) {
          const aiAnalysis = data.choices[0].message.content;
          displayAIAnalysis(aiAnalysis, stages);
        } else {
          throw new Error("APIè¿”å›æ ¼å¼ä¸æ­£ç¡®ï¼Œç¼ºå°‘åˆ†æå†…å®¹");
        }
      } catch (error) {




        console.error("AI APIè°ƒç”¨å¤±è´¥:", error);

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯å¹¶ä½¿ç”¨å¤‡ç”¨åˆ†æ
        const errorMessage = `
                    <div class="bg-red-100 text-red-700 p-3 rounded-lg mb-3">
                        <i class="fa fa-exclamation-triangle mr-2"></i>AIåˆ†ææœåŠ¡æš‚æ—¶ä¸å¯ç”¨
                        <br>
                        AI Analysis Service is temporarily unavailable
                    </div>
                    <p class="text-sm">é”™è¯¯è¯¦æƒ…ï¼š${error.message}</p>
                    <p class="text-sm mt-2">æˆ‘ä»¬çš„AIåˆ†ææœåŠ¡æ­£åœ¨ç»´æŠ¤ä¸­ï¼Œè¯·ç¨åå†è¯•ã€‚</p>
                    <p class="text-sm mt-1">Our AI analysis service is under maintenance, please try again later.</p>
                `;

        // ä½¿ç”¨å¤‡ç”¨åˆ†æ
        const now = new Date();
        const lunar = convertSolarToLunar(now);
        const shichen = getShichenInfo(now);
        const stages = calculateNineGodStages(
          lunar.monthNum,
          lunar.dayNum,
          shichen.number
        );
        const backupAnalysis = generateBackupAnalysis(
          stages,
          currentQuestion
        );

        document.getElementById("analysisContent").innerHTML =
          errorMessage + backupAnalysis;
        document.getElementById("loadingState").classList.add("hidden");
        document.getElementById("aiResult").classList.remove("hidden");
        document
          .getElementById("nineGodsPrediction")
          .classList.remove("hidden");
        updateDisplay();
      }
    }

    // æ˜¾ç¤ºAIåˆ†æç»“æœ
    function displayAIAnalysis(aiAnalysis, stages) {
      const analysisHtml = `
                <div class="space-y-4">
                    <div class="bg-white/20 rounded-lg p-3">
                        <div class="text-sm font-semibold mb-2">é’ˆå¯¹æ‚¨çš„é—®é¢˜ï¼š<span class="text-yellow-200">"${currentQuestion}"</span></div>
                        <div class="text-sm font-semibold mb-2">For your question: <span class="text-yellow-200">"${currentQuestion}"</span></div>
                        <div class="text-xs text-white/80">AIåˆ†ææ—¶é—´ï¼š${new Date().toLocaleTimeString()}</div>
                        <div class="text-xs text-white/80">AI Analysis Time: ${new Date().toLocaleTimeString(
        "en-US"
      )}</div>
                    </div>
                    
                    <div class="bg-white/10 rounded-lg p-4">
                        <div class="font-semibold mb-3 flex items-center">
                            <i class="fa fa-star mr-2 text-yellow-300"></i>
                            <span class="chinese-text">AIä¸“ä¸šåˆ†æ</span>
                            <span class="english-text ml-2">AI Professional Analysis</span>
                        </div>
                        <div class="text-sm leading-relaxed whitespace-pre-line">${aiAnalysis}</div>
                    </div>
                    
                    <div class="bg-white/10 rounded-lg p-3">
                        <div class="font-semibold mb-2 flex items-center">
                            <i class="fa fa-calculator mr-2 text-yellow-300"></i>
                            <span class="chinese-text">ç®—æ³•ä¾æ®</span>
                            <span class="english-text ml-2">Algorithm Basis</span>
                        </div>
                        <div class="text-xs leading-relaxed">
                            <div class="mb-1">â€¢ ç¬¬ä¸€é˜¶æ®µï¼ˆæœˆä¸Šèµ·æ•°ï¼‰ï¼š${stages[0].name
        } (${stages[0].nameEn}) - ${stages[0].meaning}</div>
                            <div class="mb-1">â€¢ Stage 1 (Moon Calculation): ${stages[0].name
        } (${stages[0].nameEn}) - ${stages[0].meaningEn
        }</div>
                            <div class="mb-1">â€¢ ç¬¬äºŒé˜¶æ®µï¼ˆæ—¥ä¸Šèµ·æ•°ï¼‰ï¼š${stages[1].name
        } (${stages[1].nameEn}) - ${stages[1].meaning}</div>
                            <div class="mb-1">â€¢ Stage 2 (Sun Calculation): ${stages[1].name
        } (${stages[1].nameEn}) - ${stages[1].meaningEn
        }</div>
                            <div>â€¢ ç¬¬ä¸‰é˜¶æ®µï¼ˆæ—¶ä¸Šèµ·æ•°ï¼‰ï¼š${stages[2].name} (${stages[2].nameEn
        }) - ${stages[2].meaning}</div>
                            <div>â€¢ Stage 3 (Hour Calculation): ${stages[2].name
        } (${stages[2].nameEn}) - ${stages[2].meaningEn
        }</div>
                        </div>
                    </div>
                </div>
            `;

      document.getElementById("analysisContent").innerHTML = analysisHtml;
      document.getElementById("loadingState").classList.add("hidden");
      document.getElementById("aiResult").classList.remove("hidden");

      // æ˜¾ç¤ºé“é—¨ä¹ç¥ä¸‰é˜¶æ®µé¢„æµ‹
      document
        .getElementById("nineGodsPrediction")
        .classList.remove("hidden");

      // æ›´æ–°ä¹ç¥é¢„æµ‹å†…å®¹
      updateDisplay();

      // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
      setTimeout(() => {
        document
          .getElementById("aiResult")
          .scrollIntoView({ behavior: "smooth", block: "center" });
      }, 100);
    }

    // å¤‡ç”¨åˆ†æç”Ÿæˆå‡½æ•°ï¼ˆå½“APIä¸å¯ç”¨æ—¶ä½¿ç”¨ï¼‰
    function generateBackupAnalysis(stages, question) {
      const questionType = analyzeQuestionType(question);
      let analysis = "";
      let analysisEn = "";

      switch (questionType) {
        case "love":
          [analysis, analysisEn] = generateLoveAnalysis(stages);
          break;
        case "career":
          [analysis, analysisEn] = generateCareerAnalysis(stages);
          break;
        case "finance":
          [analysis, analysisEn] = generateFinanceAnalysis(stages);
          break;
        case "health":
          [analysis, analysisEn] = generateHealthAnalysis(stages);
          break;
        case "fortune":
          [analysis, analysisEn] = generateFortuneAnalysis(stages);
          break;
        default:
          [analysis, analysisEn] = generateGeneralAnalysis(stages);
      }

      return `
                <div class="bg-white/10 rounded-lg p-4 mt-3">
                    <div class="font-semibold mb-3 flex items-center">
                        <i class="fa fa-bullseye mr-2 text-yellow-300"></i>
                        <span class="chinese-text">å¤‡ç”¨åˆ†æç»“æœ</span>
                        <span class="english-text ml-2">Backup Analysis Result</span>
                    </div>
                    <div class="text-sm leading-relaxed">${analysis}<br><br>${analysisEn}</div>
                </div>
            `;
    }

    // é—®é¢˜ç±»å‹åˆ†æ
    function analyzeQuestionType(question) {
      question = question.toLowerCase();

      if (
        question.includes("æ„Ÿæƒ…") ||
        question.includes("çˆ±æƒ…") ||
        question.includes("å©šå§»") ||
        question.includes("æ‹çˆ±")
      ) {
        return "love";
      } else if (
        question.includes("å·¥ä½œ") ||
        question.includes("äº‹ä¸š") ||
        question.includes("æ±‚èŒ") ||
        question.includes("èŒåœº")
      ) {
        return "career";
      } else if (
        question.includes("è´¢è¿") ||
        question.includes("é’±") ||
        question.includes("æŠ•èµ„") ||
        question.includes("ç†è´¢")
      ) {
        return "finance";
      } else if (
        question.includes("å¥åº·") ||
        question.includes("èº«ä½“") ||
        question.includes("ç–¾ç—…") ||
        question.includes("å…»ç”Ÿ")
      ) {
        return "health";
      } else if (
        question.includes("è¿åŠ¿") ||
        question.includes("è¿æ°”") ||
        question.includes("ä»Šæ—¥") ||
        question.includes("æ˜å¤©")
      ) {
        return "fortune";
      } else {
        return "general";
      }
    }

    // å„ç§ç±»å‹çš„å¤‡ç”¨åˆ†æå‡½æ•° - åŒè¯­ç‰ˆ
    function generateLoveAnalysis(stages) {
      const [first, second, third] = stages;
      const goodGods = stages.filter((god) =>
        ["å¤§å®‰", "é€Ÿå–œ", "å°å‰", "å¤©å¾·"].includes(god.name)
      ).length;

      if (goodGods >= 2) {
        const analysis = `æ ¹æ®é“é—¨ä¹ç¥ç®—æ³•åˆ†æï¼Œæ‚¨çš„æ„Ÿæƒ…è¿åŠ¿æ•´ä½“å‘å¥½ã€‚åˆæœŸ${first.name}æ˜¾ç¤ºæ„Ÿæƒ…åŸºç¡€ç¨³å›ºï¼Œä¸­æœŸ${second.name}è¡¨æ˜å…³ç³»å‘å±•é¡ºåˆ©ï¼Œè™½ç„¶åæœŸ${third.name}éœ€è¦æ³¨æ„ä¸€äº›å°é—®é¢˜ï¼Œä½†æ•´ä½“æ¥çœ‹æ„Ÿæƒ…å‘å±•å‰æ™¯ä¹è§‚ã€‚å»ºè®®æ‚¨çæƒœå½“å‰çš„æ„Ÿæƒ…çŠ¶æ€ï¼Œå¤šä¸å¯¹æ–¹æ²Ÿé€šäº¤æµï¼Œä¿æŒçœŸè¯šå’Œä¿¡ä»»ã€‚`;
        const analysisEn = `According to the Daoist Nine Gods algorithm analysis, your love fortune is generally good. The initial ${first.nameEn} shows a solid emotional foundation, the middle ${second.nameEn} indicates smooth relationship development, although the final ${third.nameEn} needs attention to some small issues, overall the emotional development prospects are optimistic. It is recommended that you cherish your current emotional state, communicate more with each other, and maintain sincerity and trust.`;
        return [analysis, analysisEn];
      } else {
        const analysis = `æ ¹æ®é“é—¨ä¹ç¥ç®—æ³•åˆ†æï¼Œæ‚¨çš„æ„Ÿæƒ…è¿åŠ¿éœ€è¦ç”¨å¿ƒç»è¥ã€‚åˆæœŸ${first.name}æ˜¾ç¤ºæ„Ÿæƒ…å¯èƒ½é‡åˆ°ä¸€äº›è€ƒéªŒï¼Œä¸­æœŸ${second.name}è¡¨æ˜éœ€è¦æ›´å¤šè€å¿ƒå’Œç†è§£ï¼ŒåæœŸ${third.name}æé†’æ‚¨è¦æ³¨æ„æ„Ÿæƒ…ä¸­çš„ç»†èŠ‚é—®é¢˜ã€‚å»ºè®®æ‚¨ä¿æŒç†æ€§å’Œå†·é™ï¼Œå¤šä¸ºå¯¹æ–¹ç€æƒ³ï¼Œé¿å…å†²åŠ¨è¡Œäº‹ã€‚`;
        const analysisEn = `According to the Daoist Nine Gods algorithm analysis, your love fortune needs careful management. The initial ${first.nameEn} shows that the relationship may encounter some tests, the middle ${second.nameEn} indicates that more patience and understanding are needed, and the final ${third.nameEn} reminds you to pay attention to details in the relationship. It is recommended that you remain rational and calm, think more for each other, and avoid impulsive actions.`;
        return [analysis, analysisEn];
      }
    }

    function generateCareerAnalysis(stages) {
      const [first, second, third] = stages;
      const goodGods = stages.filter((god) =>
        ["å¤§å®‰", "é€Ÿå–œ", "å°å‰", "å¤©å¾·"].includes(god.name)
      ).length;

      if (goodGods >= 2) {
        const analysis = `æ ¹æ®é“é—¨ä¹ç¥ç®—æ³•åˆ†æï¼Œæ‚¨çš„äº‹ä¸šè¿åŠ¿è‰¯å¥½ã€‚åˆæœŸ${first.name}æ˜¾ç¤ºå·¥ä½œåŸºç¡€æ‰å®ï¼Œä¸­æœŸ${second.name}è¡¨æ˜äº‹ä¸šå‘å±•é¡ºåˆ©ï¼Œè™½ç„¶åæœŸ${third.name}éœ€è¦æ³¨æ„ä¸€äº›æŒ‘æˆ˜ï¼Œä½†æ•´ä½“æ¥çœ‹èŒä¸šå‘å±•å‰æ™¯å…‰æ˜ã€‚å»ºè®®æ‚¨æŠ“ä½æœºé‡ï¼Œå‹‡äºæ‰¿æ‹…è´£ä»»ï¼Œä¸åŒäº‹ä¿æŒè‰¯å¥½å…³ç³»ã€‚`;
        const analysisEn = `According to the Daoist Nine Gods algorithm analysis, your career fortune is good. The initial ${first.nameEn} shows a solid work foundation, the middle ${second.nameEn} indicates smooth career development, although the final ${third.nameEn} needs attention to some challenges, overall the career development prospects are bright. It is recommended that you seize opportunities, courageously take responsibility, and maintain good relationships with colleagues.`;
        return [analysis, analysisEn];
      } else {
        const analysis = `æ ¹æ®é“é—¨ä¹ç¥ç®—æ³•åˆ†æï¼Œæ‚¨çš„äº‹ä¸šè¿åŠ¿éœ€è¦åŠªåŠ›ã€‚åˆæœŸ${first.name}æ˜¾ç¤ºå·¥ä½œå¯èƒ½é‡åˆ°ä¸€äº›å›°éš¾ï¼Œä¸­æœŸ${second.name}è¡¨æ˜éœ€è¦æ›´å¤šåŠªåŠ›å’ŒåšæŒï¼ŒåæœŸ${third.name}æé†’æ‚¨è¦æå‡è‡ªå·±çš„èƒ½åŠ›å’ŒæŠ€èƒ½ã€‚å»ºè®®æ‚¨ä¿æŒå­¦ä¹ æ€åº¦ï¼Œä¸æ–­æå‡ä¸“ä¸šæ°´å¹³ï¼ŒæŠ“ä½åˆé€‚çš„æœºä¼šã€‚`;
        const analysisEn = `According to the Daoist Nine Gods algorithm analysis, your career fortune requires effort. The initial ${first.nameEn} shows that work may encounter some difficulties, the middle ${second.nameEn} indicates that more effort and persistence are needed, and the final ${third.nameEn} reminds you to improve your abilities and skills. It is recommended that you maintain a learning attitude, continuously improve your professional level, and seize appropriate opportunities.`;
        return [analysis, analysisEn];
      }
    }

    function generateFinanceAnalysis(stages) {
      const [first, second, third] = stages;
      const goodGods = stages.filter((god) =>
        ["å¤§å®‰", "é€Ÿå–œ", "å°å‰", "å¤©å¾·"].includes(god.name)
      ).length;

      if (goodGods >= 2) {
        const analysis = `æ ¹æ®é“é—¨ä¹ç¥ç®—æ³•åˆ†æï¼Œæ‚¨çš„è´¢è¿æ•´ä½“å‘å¥½ã€‚åˆæœŸ${first.name}æ˜¾ç¤ºè´¢åŠ¡åŸºç¡€ç¨³å›ºï¼Œä¸­æœŸ${second.name}è¡¨æ˜æŠ•èµ„æœ‰å›æŠ¥ï¼ŒåæœŸ${third.name}æé†’æ‚¨è¦ç†æ€§ç†è´¢ã€‚å»ºè®®æ‚¨åˆ¶å®šåˆç†çš„è´¢åŠ¡è§„åˆ’ï¼Œåˆ†æ•£æŠ•èµ„é£é™©ï¼Œä¿æŒä¸€å®šçš„åº”æ€¥èµ„é‡‘å‚¨å¤‡ã€‚`;
        const analysisEn = `According to the Daoist Nine Gods algorithm analysis, your financial fortune is generally good. The initial ${first.nameEn} shows a solid financial foundation, the middle ${second.nameEn} indicates investment returns, and the final ${third.nameEn} reminds you to manage finances rationally. It is recommended that you develop a reasonable financial plan, diversify investment risks, and maintain a certain emergency fund reserve.`;
        return [analysis, analysisEn];
      } else {
        const analysis = `æ ¹æ®é“é—¨ä¹ç¥ç®—æ³•åˆ†æï¼Œæ‚¨çš„è´¢è¿éœ€è¦è°¨æ…ã€‚åˆæœŸ${first.name}æ˜¾ç¤ºè´¢åŠ¡å¯èƒ½é‡åˆ°å‹åŠ›ï¼Œä¸­æœŸ${second.name}è¡¨æ˜æŠ•èµ„éœ€è°¨æ…ï¼ŒåæœŸ${third.name}æé†’æ‚¨è¦æ§åˆ¶æ”¯å‡ºã€‚å»ºè®®æ‚¨åšå¥½è´¢åŠ¡è§„åˆ’ï¼Œé¿å…é«˜é£é™©æŠ•èµ„ï¼Œä¿æŒç¨³å¥çš„ç†è´¢ç­–ç•¥ã€‚`;
        const analysisEn = `According to the Daoist Nine Gods algorithm analysis, your financial fortune needs caution. The initial ${first.nameEn} shows that finances may encounter pressure, the middle ${second.nameEn} indicates that investments need caution, and the final ${third.nameEn} reminds you to control expenses. It is recommended that you make financial plans, avoid high-risk investments, and maintain a prudent financial management strategy.`;
        return [analysis, analysisEn];
      }
    }

    function generateHealthAnalysis(stages) {
      const [first, second, third] = stages;
      const hasBingfu = stages.some((god) => god.name === "ç—…ç¬¦");

      if (hasBingfu) {
        const analysis = `æ ¹æ®é“é—¨ä¹ç¥ç®—æ³•åˆ†æï¼Œæ‚¨éœ€è¦ç‰¹åˆ«å…³æ³¨å¥åº·çŠ¶å†µã€‚${stages.find((god) => god.name === "ç—…ç¬¦").name
          }çš„å‡ºç°æé†’æ‚¨è¦æ³¨æ„èº«ä½“å¥åº·ï¼ŒåŠæ—¶ä½“æ£€ï¼Œé¢„é˜²ç–¾ç—…ã€‚å»ºè®®æ‚¨ä¿æŒè§„å¾‹ä½œæ¯ï¼Œæ³¨æ„é¥®é£Ÿå¥åº·ï¼ŒåšæŒé€‚é‡è¿åŠ¨ï¼Œä¿æŒå¿ƒæƒ…èˆ’ç•…ã€‚`;
        const analysisEn = `According to the Daoist Nine Gods algorithm analysis, you need to pay special attention to your health condition. The appearance of ${stages.find((god) => god.name === "ç—…ç¬¦").nameEn
          } reminds you to pay attention to your health, have timely medical check-ups, and prevent diseases. It is recommended that you maintain a regular schedule, pay attention to healthy eating,åšæŒ moderate exercise, and maintain a happy mood.`;
        return [analysis, analysisEn];
      } else {
        const analysis = `æ ¹æ®é“é—¨ä¹ç¥ç®—æ³•åˆ†æï¼Œæ‚¨çš„å¥åº·çŠ¶å†µæ•´ä½“è‰¯å¥½ã€‚åˆæœŸ${first.name}æ˜¾ç¤ºèº«ä½“åŸºç¡€å¥åº·ï¼Œä¸­æœŸ${second.name}è¡¨æ˜ç²¾åŠ›å……æ²›ï¼ŒåæœŸ${third.name}æé†’æ‚¨è¦ä¿æŒè‰¯å¥½çš„ç”Ÿæ´»ä¹ æƒ¯ã€‚å»ºè®®æ‚¨ç»§ç»­ä¿æŒå¥åº·çš„ç”Ÿæ´»æ–¹å¼ï¼Œå®šæœŸä½“æ£€ï¼Œé¢„é˜²ä¸ºä¸»ã€‚`;
        const analysisEn = `According to the Daoist Nine Gods algorithm analysis, your health condition is generally good. The initial ${first.nameEn} shows a healthy physical foundation, the middle ${second.nameEn} indicates abundant energy, and the final ${third.nameEn} reminds you to maintain good living habits. It is recommended that you continue to maintain a healthy lifestyle, have regular medical check-ups, and focus on prevention.`;
        return [analysis, analysisEn];
      }
    }

    function generateFortuneAnalysis(stages) {
      const [first, second, third] = stages;
      const goodGods = stages.filter((god) =>
        ["å¤§å®‰", "é€Ÿå–œ", "å°å‰", "å¤©å¾·"].includes(god.name)
      ).length;

      if (goodGods >= 2) {
        const analysis = `æ ¹æ®é“é—¨ä¹ç¥ç®—æ³•åˆ†æï¼Œæ‚¨çš„æ•´ä½“è¿åŠ¿ä¸é”™ã€‚åˆæœŸ${first.name}æ˜¾ç¤ºèµ·ç‚¹è‰¯å¥½ï¼Œä¸­æœŸ${second.name}è¡¨æ˜å‘å±•é¡ºåˆ©ï¼ŒåæœŸ${third.name}è™½ç„¶æœ‰äº›å°æŒ‘æˆ˜ï¼Œä½†æ•´ä½“æ¥çœ‹è¿åŠ¿å‘å¥½ã€‚å»ºè®®æ‚¨ä¿æŒç§¯æä¹è§‚çš„å¿ƒæ€ï¼ŒæŠ“ä½æœºé‡ï¼Œå‹‡äºå°è¯•æ–°äº‹ç‰©ã€‚`;
        const analysisEn = `According to the Daoist Nine Gods algorithm analysis, your overall fortune is good. The initial ${first.nameEn} shows a good starting point, the middle ${second.nameEn} indicates smooth development, and although the final ${third.nameEn} has some small challenges, overall the fortune is positive. It is recommended that you maintain a positive and optimistic attitude, seize opportunities, and courageously try new things.`;
        return [analysis, analysisEn];
      } else {
        const analysis = `æ ¹æ®é“é—¨ä¹ç¥ç®—æ³•åˆ†æï¼Œæ‚¨çš„æ•´ä½“è¿åŠ¿éœ€è¦åŠªåŠ›ã€‚åˆæœŸ${first.name}æ˜¾ç¤ºæœ‰äº›é˜»ç¢ï¼Œä¸­æœŸ${second.name}è¡¨æ˜éœ€è¦æ›´å¤šåŠªåŠ›ï¼ŒåæœŸ${third.name}æé†’æ‚¨è¦ç§¯æé¢å¯¹æŒ‘æˆ˜ã€‚å»ºè®®æ‚¨ä¿æŒè€å¿ƒå’Œæ¯…åŠ›ï¼Œä¸è¦è½»æ˜“æ”¾å¼ƒï¼Œç›¸ä¿¡å›°éš¾ä¼šè¿‡å»çš„ã€‚`;
        const analysisEn = `According to the Daoist Nine Gods algorithm analysis, your overall fortune requires effort. The initial ${first.nameEn} shows some obstacles, the middle ${second.nameEn} indicates that more effort is needed, and the final ${third.nameEn} reminds you to actively face challenges. It is recommended that you maintain patience and perseverance, do not give up easily, and believe that difficulties will pass.`;
        return [analysis, analysisEn];
      }
    }

    function generateGeneralAnalysis(stages) {
      const [first, second, third] = stages;
      const analysis = `æ ¹æ®é“é—¨ä¹ç¥ç®—æ³•åˆ†æï¼Œæ‚¨è¯¢é—®çš„äº‹æƒ…å‘å±•è¿‡ç¨‹å¦‚ä¸‹ï¼šåˆæœŸ${first.name}ï¼ˆ${first.meaning}ï¼‰ï¼Œä¸­æœŸ${second.name}ï¼ˆ${second.meaning}ï¼‰ï¼ŒåæœŸ${third.name}ï¼ˆ${third.meaning}ï¼‰ã€‚æ•´ä½“æ¥çœ‹ï¼Œäº‹æƒ…å‘å±•æœ‰å…¶è‡ªèº«è§„å¾‹ï¼Œå»ºè®®æ‚¨ä¿æŒå¹³å¸¸å¿ƒï¼Œç§¯æé¢å¯¹ï¼Œåšå¥½å……åˆ†å‡†å¤‡ï¼Œç›¸ä¿¡ä¼šæœ‰å¥½çš„ç»“æœã€‚`;
      const analysisEn = `According to the Daoist Nine Gods algorithm analysis, the development process of the matter you asked about is as follows: Initial stage ${first.nameEn} (${first.meaningEn}), Middle stage ${second.nameEn} (${second.meaningEn}), Final stage ${third.nameEn} (${third.meaningEn}). Overall, things develop according to their own laws. It is recommended that you maintain a normal mind, face it actively, make full preparations, and believe that there will be good results.`;
      return [analysis, analysisEn];
    }

    function clearAnalysis() {
      document.getElementById("questionInput").value = "";
      document.getElementById("aiResult").classList.add("hidden");
      document.getElementById("nineGodsPrediction").classList.add("hidden");
      currentQuestion = "";
    }

    // åˆå§‹åŒ–
    document.addEventListener("DOMContentLoaded", function () {
      // åˆå§‹æ›´æ–°æ˜¾ç¤ºï¼ˆè™½ç„¶é»˜è®¤éšè—ï¼Œä½†éœ€è¦å…ˆè®¡ç®—å¥½ï¼‰
      updateDisplay();

      // æ¯ç§’æ›´æ–°æ—¶é—´
      setInterval(updateDisplay, 1000);

      // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
      document
        .getElementById("paymentModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            cancelPayment();
          }
        });

      // é˜»æ­¢é¡µé¢ç¼©æ”¾
      document.addEventListener(
        "touchstart",
        function (e) {
          if (e.touches.length > 1) {
            e.preventDefault();
          }
        },
        { passive: false }
      );

      document.addEventListener("gesturestart", function (e) {
        e.preventDefault();
      });

      // æ£€æŸ¥æ”¯ä»˜è¿”å›ç»“æœ
      checkPaymentResult();
    });

    // åŠ å¯†å‡½æ•°
    function encryptData(data, key = 'payment_key_2023') {
      // ç®€å•çš„åŠ å¯†å®ç°ï¼Œå®é™…é¡¹ç›®ä¸­åº”ä½¿ç”¨æ›´å®‰å…¨çš„åŠ å¯†æ–¹æ³•
      const encrypted = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
      return encrypted;
    }

    // è§£å¯†å‡½æ•°
    function decryptData(encryptedData, key = 'payment_key_2023') {
      try {
        const decrypted = JSON.parse(decodeURIComponent(escape(atob(encryptedData))));
        return decrypted;
      } catch (e) {
        console.error('è§£å¯†å¤±è´¥:', e);
        return null;
      }
    }

    // ç”ŸæˆåŠ å¯†çš„å›è°ƒå‚æ•°
    function generateEncryptedCallbackParams(question) {
      const callbackData = {
        status: 'success',
        question: question,
        timestamp: new Date().getTime(),
        // æ·»åŠ éšæœºæ•°é˜²æ­¢é‡æ”¾æ”»å‡»
        nonce: Math.random().toString(36).substring(2, 15)
      };
      
      // åŠ å¯†å›è°ƒæ•°æ®
      const encryptedData = encryptData(callbackData);
      
      // ç”Ÿæˆç­¾åï¼Œé˜²æ­¢å‚æ•°è¢«ç¯¡æ”¹
      const signature = md5(encryptedData + '6Ecg3jrd3W4jcOADKclHaU0N5AsWftbB');
      
      return {
        data: encryptedData,
        sign: signature
      };
    }

    // æ£€æŸ¥æ”¯ä»˜è¿”å›ç»“æœ
    function checkPaymentResult() {
      // ä½¿ç”¨URLSearchParamsè·å–URLå‚æ•°
      const params = new URLSearchParams(window.location.search);
      console.log('å½“å‰è·¯ç”±å‚æ•°:', window.location.search);
      
      // æ£€æŸ¥æ˜¯å¦æœ‰åŠ å¯†çš„å›è°ƒå‚æ•°
      const encryptedData = params.get('data');
      const signature = params.get('sign');
      
      // å¦‚æœæœ‰åŠ å¯†çš„å›è°ƒå‚æ•°
      if (encryptedData && signature) {
        // éªŒè¯ç­¾å
        const expectedSignature = md5(encryptedData + '6Ecg3jrd3W4jcOADKclHaU0N5AsWftbB');
        
        if (signature !== expectedSignature) {
          console.error('å›è°ƒå‚æ•°ç­¾åéªŒè¯å¤±è´¥');
          clearAllUrlParams(); // å³ä½¿éªŒè¯å¤±è´¥ä¹Ÿè¦æ¸…é™¤æ‰€æœ‰å‚æ•°
          return;
        }
        
        // è§£å¯†å›è°ƒæ•°æ®
        const callbackData = decryptData(encryptedData);
        
        if (!callbackData) {
          console.error('å›è°ƒå‚æ•°è§£å¯†å¤±è´¥');
          clearAllUrlParams(); // å³ä½¿è§£å¯†å¤±è´¥ä¹Ÿè¦æ¸…é™¤æ‰€æœ‰å‚æ•°
          return;
        }
        
        // æ£€æŸ¥æ—¶é—´æˆ³ï¼Œé˜²æ­¢é‡æ”¾æ”»å‡»ï¼ˆ5åˆ†é’Ÿå†…æœ‰æ•ˆï¼‰
        const currentTime = new Date().getTime();
        if (currentTime - callbackData.timestamp > 5 * 60 * 1000) {
          console.error('å›è°ƒå‚æ•°å·²è¿‡æœŸ');
          clearAllUrlParams(); // å³ä½¿è¿‡æœŸä¹Ÿè¦æ¸…é™¤æ‰€æœ‰å‚æ•°
          return;
        }
        
        // å¦‚æœæœ‰æ”¯ä»˜æˆåŠŸçŠ¶æ€ä¸”æœ‰å’¨è¯¢é—®é¢˜
        if (callbackData.status === 'success' && callbackData.question) {
          // è®¾ç½®é—®é¢˜åˆ°è¾“å…¥æ¡†
          document.getElementById("questionInput").value = callbackData.question;
          currentQuestion = callbackData.question;
          
          // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
          document.getElementById("loadingState").classList.remove("hidden");
          document.getElementById("aiResult").classList.add("hidden");
          
          // è‡ªåŠ¨è§¦å‘å åœåˆ†æ
          setTimeout(() => {
            callAIApiForAnalysis();
          }, 500);
        }
        
        // æ¸…é™¤æ‰€æœ‰URLå‚æ•°ï¼ŒåŒ…æ‹¬æ”¯ä»˜å¹³å°å¯èƒ½è¿”å›çš„æ•æ„Ÿå‚æ•°
        clearAllUrlParams();
      } else {
        // å…¼å®¹æ—§çš„å›è°ƒæ–¹å¼ï¼ˆæœªåŠ å¯†çš„å‚æ•°ï¼‰
        const status = params.get('callbackStatus');
        const question = params.get('question');
        
        // å¦‚æœæœ‰æ”¯ä»˜æˆåŠŸçŠ¶æ€ä¸”æœ‰å’¨è¯¢é—®é¢˜
        if (status === 'success' && question) {
          // è®¾ç½®é—®é¢˜åˆ°è¾“å…¥æ¡†
          document.getElementById("questionInput").value = decodeURIComponent(question);
          currentQuestion = decodeURIComponent(question);
          
          // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
          document.getElementById("loadingState").classList.remove("hidden");
          document.getElementById("aiResult").classList.add("hidden");
          
          // è‡ªåŠ¨è§¦å‘å åœåˆ†æ
          setTimeout(() => {
            callAIApiForAnalysis();
          }, 500);
        }
        
        // æ— è®ºæ˜¯å¦æœ‰æœ‰æ•ˆçš„å›è°ƒå‚æ•°ï¼Œéƒ½è¦æ¸…é™¤æ‰€æœ‰URLå‚æ•°
        // è¿™å¯ä»¥é˜²æ­¢æ”¯ä»˜å¹³å°è¿”å›çš„æ•æ„Ÿå‚æ•°ï¼ˆå¦‚pidã€keyç­‰ï¼‰æš´éœ²åœ¨URLä¸­
        clearAllUrlParams();
      }
    }
    
    // æ¸…é™¤æ‰€æœ‰URLå‚æ•°
    function clearAllUrlParams() {
      const url = new URL(window.location);
      
      // è·å–æ‰€æœ‰å‚æ•°å
      const allParams = Array.from(url.searchParams.keys());
      
      // åˆ é™¤æ‰€æœ‰å‚æ•°
      allParams.forEach(param => {
        url.searchParams.delete(param);
      });
      
      // æ›´æ–°URLï¼Œä¸ä¿ç•™ä»»ä½•å‚æ•°
      window.history.replaceState({}, document.title, url.pathname);
      console.log('å·²æ¸…é™¤æ‰€æœ‰URLå‚æ•°');
    }

    // é”®ç›˜ä¼˜åŒ–
    document
      .getElementById("questionInput")
      .addEventListener("input", function () {
        // è‡ªåŠ¨è°ƒæ•´æ–‡æœ¬æ¡†é«˜åº¦
        this.style.height = "auto";
        this.style.height =
          (this.scrollHeight > 160 ? 160 : this.scrollHeight) + "px";
      });
  </script>
  <script src="https://cdn.bootcdn.net/ajax/libs/blueimp-md5/2.16.0/js/md5.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>

    let data = {
      pid: "2025111020404744",
      money: "0.01",
      name: "test",
      notify_url: "http://www.xiaoliuren.xyz", //å¼‚æ­¥é€šçŸ¥åœ°å€
      out_trade_no: new Date().getTime() + Math.floor(Math.random() * 1000), //è®¢å•å·,è‡ªå·±ç”Ÿæˆã€‚æˆ‘æ˜¯å½“å‰æ—¶é—´YYYYMMDDHHmmsså†åŠ ä¸Šéšæœºä¸‰ä½æ•°
      return_url: window.location.href.split('?')[0] + "?callbackStatus=success", //è·³è½¬é€šçŸ¥åœ°å€
      sitename: "ç½‘ç«™åç§°",
      type: "alipay", //æ”¯ä»˜æ–¹å¼:alipay:æ”¯ä»˜å®,wxpay:å¾®ä¿¡æ”¯ä»˜,qqpay:QQé’±åŒ…,tenpay:è´¢ä»˜é€š,
    };

    //å‚æ•°è¿›è¡Œæ’åºæ‹¼æ¥å­—ç¬¦ä¸²(éå¸¸é‡è¦)
    function getVerifyParams(params) {
      var sPara = [];
      if (!params) return null;
      for (var key in params) {
        if (!params[key] || key == "sign" || key == "sign_type") {
          continue;
        }
        sPara.push([key, params[key]]);
      }
      sPara = sPara.sort();
      var prestr = "";
      for (var i2 = 0; i2 < sPara.length; i2++) {
        var obj = sPara[i2];
        if (i2 == sPara.length - 1) {
          prestr = prestr + obj[0] + "=" + obj[1] + "";
        } else {
          prestr = prestr + obj[0] + "=" + obj[1] + "&";
        }
      }
      return prestr;
    }

    let str = getVerifyParams(data);
    let key = "6Ecg3jrd3W4jcOADKclHaU0N5AsWftbB"; //å¯†é’¥,æ˜“æ”¯ä»˜æ³¨å†Œä¼šæä¾›pidå’Œç§˜é’¥
    let sign = md5(str + key); //æ³¨æ„æ”¯ä»˜å®è§„å®šç­¾åæ—¶:å¾…ç­¾åå­—ç¬¦ä¸²åè¦åŠ key
    let result = `https://z-pay.cn/submit.php?${str}&sign=${sign}&sign_type=MD5`;
    console.log("str", str);

    document.querySelector(".confirm-btn").addEventListener("click", async function () {
      // ç¡®è®¤æ”¯ä»˜é€»è¾‘
      console.log("ç¡®è®¤æ”¯ä»˜");
      
      // è·å–å½“å‰è¾“å…¥çš„é—®é¢˜
      const question = document.getElementById("questionInput").value.trim();
      
      // éªŒè¯é—®é¢˜æ˜¯å¦ä¸ºç©º
      if (!question) {
        alert("è¯·è¾“å…¥æ‚¨æƒ³è¦å åœçš„é—®é¢˜");
        return;
      }
      
      // æ›´æ–°return_urlï¼Œä½¿ç”¨åŠ å¯†çš„å›è°ƒå‚æ•°
      const baseUrl = window.location.href.split('?')[0];
      const encryptedParams = generateEncryptedCallbackParams(question);
      data.return_url = baseUrl + "?data=" + encodeURIComponent(encryptedParams.data) + "&sign=" + encodeURIComponent(encryptedParams.sign);
      
      // é‡æ–°è®¡ç®—ç­¾åï¼Œå› ä¸ºreturn_urlå·²æ›´æ”¹
      let str = getVerifyParams(data);
      let key = "6Ecg3jrd3W4jcOADKclHaU0N5AsWftbB"; //å¯†é’¥,æ˜“æ”¯ä»˜æ³¨å†Œä¼šæä¾›pidå’Œç§˜é’¥
      let sign = md5(str + key); //æ³¨æ„æ”¯ä»˜å®è§„å®šç­¾åæ—¶:å¾…ç­¾åå­—ç¬¦ä¸²åè¦åŠ key
      
      // å‡†å¤‡æ”¯ä»˜å‚æ•°
      const paymentParams = {
        ...data,
        sign: sign,
        sign_type: "MD5"
      };
      
      console.log("æ”¯ä»˜å‚æ•°:", paymentParams);
      
      try {
        // ä½¿ç”¨axioså‘é€POSTè¯·æ±‚ï¼Œå‚æ•°æ ¼å¼ä¸ºform-data
        const formData = new FormData();
        
        // æ·»åŠ æ‰€æœ‰å‚æ•°åˆ°FormData
        Object.keys(paymentParams).forEach(key => {
          formData.append(key, paymentParams[key]);
        });
        
        // ä½¿ç”¨axioså‘é€è¯·æ±‚
        const response = await axios.post('https://z-pay.cn/submit.php', formData, {
          headers: {
            'Content-Type': 'multipart/form-data'
          }
        });
        
        console.log("æ”¯ä»˜è¯·æ±‚å·²å‘é€ï¼Œå“åº”:", response.data);
        
        // å¦‚æœè¿”å›çš„æ˜¯HTMLè¡¨å•ï¼Œéœ€è¦å¤„ç†è¡¨å•æäº¤
        if (response.data && typeof response.data === 'string' && response.data.includes('<form')) {
          // åˆ›å»ºä¸€ä¸ªä¸´æ—¶divæ¥è§£æHTML
          const tempDiv = document.createElement('div');
          tempDiv.innerHTML = response.data;
          
          // æŸ¥æ‰¾è¡¨å•
          const form = tempDiv.querySelector('form');
          if (form) {
            // æäº¤è¡¨å•åˆ°æ–°çª—å£
            form.target = '_blank';
            document.body.appendChild(form);
            form.submit();
            document.body.removeChild(form);
          }
        } else if (response.data && response.data.url) {
          // å¦‚æœè¿”å›çš„æ˜¯é‡å®šå‘URLï¼Œåœ¨æ–°çª—å£æ‰“å¼€
          window.open(response.data.url, '_blank');
        } else {
          // å…¶ä»–æƒ…å†µï¼Œæ˜¾ç¤ºå“åº”ä¿¡æ¯
          alert('æ”¯ä»˜è¯·æ±‚å·²å‘é€ï¼Œè¯·æŸ¥çœ‹æ–°çª—å£å®Œæˆæ”¯ä»˜');
        }
      } catch (error) {
        console.error('æ”¯ä»˜å¤„ç†å¤±è´¥:', error);
        
        // å¦‚æœæ˜¯ç½‘ç»œé”™è¯¯æˆ–è·¨åŸŸé—®é¢˜ï¼Œå›é€€åˆ°è¡¨å•æäº¤æ–¹å¼
        if (error.code === 'NETWORK_ERROR' || error.message.includes('Network Error') || error.message.includes('CORS')) {
          console.log('ç½‘ç»œé”™è¯¯æˆ–è·¨åŸŸé—®é¢˜ï¼Œå›é€€åˆ°è¡¨å•æäº¤æ–¹å¼');
          
          // ä½¿ç”¨è¡¨å•POSTæäº¤æ–¹å¼ï¼ˆè§£å†³è·¨åŸŸé—®é¢˜ï¼‰
          const form = document.createElement('form');
          form.method = 'POST';
          form.action = 'https://z-pay.cn/submit.php';
          form.target = '_blank'; // åœ¨æ–°çª—å£æ‰“å¼€
          form.style.display = 'none'; // éšè—è¡¨å•

          // æ·»åŠ æ‰€æœ‰å‚æ•°ä½œä¸ºéšè—å­—æ®µ
          Object.keys(paymentParams).forEach(key => {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = key;
            input.value = paymentParams[key];
            form.appendChild(input);
          });

          // æäº¤è¡¨å•
          document.body.appendChild(form);
          form.submit();
          document.body.removeChild(form);
          
          console.log("æ”¯ä»˜è¡¨å•å·²æäº¤");
        } else {
          alert('æ”¯ä»˜å¤„ç†å¤±è´¥: ' + (error.response?.data?.message || error.message));
        }
      }
    });
  </script>
</body>

</html>
